<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!-->
<html>
<head>
  <meta charset="utf-8">
  
  <title>ZeptoJs 源码注释 | MXOXW</title>
  <meta name="author" content="Wind">
  <meta name="keywords" content="ZeptoJs JavaScript 源码">
  <meta name="description" content="ZeptoJs的源码解读">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta itemprop="image" content="//a.disquscdn.com/uploads/users/14817/5647/avatar92.jpg?1445168112" />
  <meta itemprop="name" content="ZeptoJs 源码注释 | MXOXW" />
  <meta itemprop="description" content="ZeptoJs的源码解读" />
  
  
<link rel="stylesheet" href="/css/style.css">

  
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">

  <link rel="canonical" href="http://www.mxoxw.com/b/2015/09/zeptojs-yuan-ma-zhu-shi/">
  
  <link rel="alternative" href="/atom.xml" title="MXOXW" type="application/atom+xml">
  
  
  
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
  <!--<link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">-->
  <!--<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">-->
  <!--<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">-->
  
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-4817791179797310",
      enable_page_level_ads: true
    });
  </script>
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body> <!-- TODO body 添加样式-->
  <header role="banner"><hgroup>
  <h1><a href="/">MXOXW</a></h1>
  
    <h2>Life always finds a way.</h2>
  
</hgroup>
</header>
  <nav role="navigation"><!-- TODO  -->
<ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
</ul>
  
<form action="https://www.google.com" target="_blank" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="http://www.mxoxw.com">
    <input class="search" type="text" name="q" results="0" placeholder="搜索..."/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">首页</a></li><li><a href="/archives/">博文列表</a></li><li><a href="/about/">关于</a></li>
</ul>


</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">ZeptoJs 源码注释</h1>
    
    
      <p class="meta">
        
          <time datetime="2015-09-15T17:37:11.000Z" itemprop="datePublished">9月 15, 2015</time>

        
        
        
           | <a href="#gitalk-container" >Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>ZeptoJs的源码解读</p>
<span id="more"></span>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br><span class="line">1485</span><br><span class="line">1486</span><br><span class="line">1487</span><br><span class="line">1488</span><br><span class="line">1489</span><br><span class="line">1490</span><br><span class="line">1491</span><br><span class="line">1492</span><br><span class="line">1493</span><br><span class="line">1494</span><br><span class="line">1495</span><br><span class="line">1496</span><br><span class="line">1497</span><br><span class="line">1498</span><br><span class="line">1499</span><br><span class="line">1500</span><br><span class="line">1501</span><br><span class="line">1502</span><br><span class="line">1503</span><br><span class="line">1504</span><br><span class="line">1505</span><br><span class="line">1506</span><br><span class="line">1507</span><br><span class="line">1508</span><br><span class="line">1509</span><br><span class="line">1510</span><br><span class="line">1511</span><br><span class="line">1512</span><br><span class="line">1513</span><br><span class="line">1514</span><br><span class="line">1515</span><br><span class="line">1516</span><br><span class="line">1517</span><br><span class="line">1518</span><br><span class="line">1519</span><br><span class="line">1520</span><br><span class="line">1521</span><br><span class="line">1522</span><br><span class="line">1523</span><br><span class="line">1524</span><br><span class="line">1525</span><br><span class="line">1526</span><br><span class="line">1527</span><br><span class="line">1528</span><br><span class="line">1529</span><br><span class="line">1530</span><br><span class="line">1531</span><br><span class="line">1532</span><br><span class="line">1533</span><br><span class="line">1534</span><br><span class="line">1535</span><br><span class="line">1536</span><br><span class="line">1537</span><br><span class="line">1538</span><br><span class="line">1539</span><br><span class="line">1540</span><br><span class="line">1541</span><br><span class="line">1542</span><br><span class="line">1543</span><br><span class="line">1544</span><br><span class="line">1545</span><br><span class="line">1546</span><br><span class="line">1547</span><br><span class="line">1548</span><br><span class="line">1549</span><br><span class="line">1550</span><br><span class="line">1551</span><br><span class="line">1552</span><br><span class="line">1553</span><br><span class="line">1554</span><br><span class="line">1555</span><br><span class="line">1556</span><br><span class="line">1557</span><br><span class="line">1558</span><br><span class="line">1559</span><br><span class="line">1560</span><br><span class="line">1561</span><br><span class="line">1562</span><br><span class="line">1563</span><br><span class="line">1564</span><br><span class="line">1565</span><br><span class="line">1566</span><br><span class="line">1567</span><br><span class="line">1568</span><br><span class="line">1569</span><br><span class="line">1570</span><br><span class="line">1571</span><br><span class="line">1572</span><br><span class="line">1573</span><br><span class="line">1574</span><br><span class="line">1575</span><br><span class="line">1576</span><br><span class="line">1577</span><br><span class="line">1578</span><br><span class="line">1579</span><br><span class="line">1580</span><br><span class="line">1581</span><br><span class="line">1582</span><br><span class="line">1583</span><br><span class="line">1584</span><br><span class="line">1585</span><br><span class="line">1586</span><br><span class="line">1587</span><br><span class="line">1588</span><br><span class="line">1589</span><br><span class="line">1590</span><br><span class="line">1591</span><br><span class="line">1592</span><br><span class="line">1593</span><br><span class="line">1594</span><br><span class="line">1595</span><br><span class="line">1596</span><br><span class="line">1597</span><br><span class="line">1598</span><br><span class="line">1599</span><br><span class="line">1600</span><br><span class="line">1601</span><br><span class="line">1602</span><br><span class="line">1603</span><br><span class="line">1604</span><br><span class="line">1605</span><br><span class="line">1606</span><br><span class="line">1607</span><br><span class="line">1608</span><br><span class="line">1609</span><br><span class="line">1610</span><br><span class="line">1611</span><br><span class="line">1612</span><br><span class="line">1613</span><br><span class="line">1614</span><br><span class="line">1615</span><br><span class="line">1616</span><br><span class="line">1617</span><br><span class="line">1618</span><br><span class="line">1619</span><br><span class="line">1620</span><br><span class="line">1621</span><br><span class="line">1622</span><br><span class="line">1623</span><br><span class="line">1624</span><br><span class="line">1625</span><br><span class="line">1626</span><br><span class="line">1627</span><br><span class="line">1628</span><br><span class="line">1629</span><br><span class="line">1630</span><br><span class="line">1631</span><br><span class="line">1632</span><br><span class="line">1633</span><br><span class="line">1634</span><br><span class="line">1635</span><br><span class="line">1636</span><br><span class="line">1637</span><br><span class="line">1638</span><br><span class="line">1639</span><br><span class="line">1640</span><br><span class="line">1641</span><br><span class="line">1642</span><br><span class="line">1643</span><br><span class="line">1644</span><br><span class="line">1645</span><br><span class="line">1646</span><br><span class="line">1647</span><br><span class="line">1648</span><br><span class="line">1649</span><br><span class="line">1650</span><br><span class="line">1651</span><br><span class="line">1652</span><br><span class="line">1653</span><br><span class="line">1654</span><br><span class="line">1655</span><br><span class="line">1656</span><br><span class="line">1657</span><br><span class="line">1658</span><br><span class="line">1659</span><br><span class="line">1660</span><br><span class="line">1661</span><br><span class="line">1662</span><br><span class="line">1663</span><br><span class="line">1664</span><br><span class="line">1665</span><br><span class="line">1666</span><br><span class="line">1667</span><br><span class="line">1668</span><br><span class="line">1669</span><br><span class="line">1670</span><br><span class="line">1671</span><br><span class="line">1672</span><br><span class="line">1673</span><br><span class="line">1674</span><br><span class="line">1675</span><br><span class="line">1676</span><br><span class="line">1677</span><br><span class="line">1678</span><br><span class="line">1679</span><br><span class="line">1680</span><br><span class="line">1681</span><br><span class="line">1682</span><br><span class="line">1683</span><br><span class="line">1684</span><br><span class="line">1685</span><br><span class="line">1686</span><br><span class="line">1687</span><br><span class="line">1688</span><br><span class="line">1689</span><br><span class="line">1690</span><br><span class="line">1691</span><br><span class="line">1692</span><br><span class="line">1693</span><br><span class="line">1694</span><br><span class="line">1695</span><br><span class="line">1696</span><br><span class="line">1697</span><br><span class="line">1698</span><br><span class="line">1699</span><br><span class="line">1700</span><br><span class="line">1701</span><br><span class="line">1702</span><br><span class="line">1703</span><br><span class="line">1704</span><br><span class="line">1705</span><br><span class="line">1706</span><br><span class="line">1707</span><br><span class="line">1708</span><br><span class="line">1709</span><br><span class="line">1710</span><br><span class="line">1711</span><br><span class="line">1712</span><br><span class="line">1713</span><br><span class="line">1714</span><br><span class="line">1715</span><br><span class="line">1716</span><br><span class="line">1717</span><br><span class="line">1718</span><br><span class="line">1719</span><br><span class="line">1720</span><br><span class="line">1721</span><br><span class="line">1722</span><br><span class="line">1723</span><br><span class="line">1724</span><br><span class="line">1725</span><br><span class="line">1726</span><br><span class="line">1727</span><br><span class="line">1728</span><br><span class="line">1729</span><br><span class="line">1730</span><br><span class="line">1731</span><br><span class="line">1732</span><br><span class="line">1733</span><br><span class="line">1734</span><br><span class="line">1735</span><br><span class="line">1736</span><br><span class="line">1737</span><br><span class="line">1738</span><br><span class="line">1739</span><br><span class="line">1740</span><br><span class="line">1741</span><br><span class="line">1742</span><br><span class="line">1743</span><br><span class="line">1744</span><br><span class="line">1745</span><br><span class="line">1746</span><br><span class="line">1747</span><br><span class="line">1748</span><br><span class="line">1749</span><br><span class="line">1750</span><br><span class="line">1751</span><br><span class="line">1752</span><br><span class="line">1753</span><br><span class="line">1754</span><br><span class="line">1755</span><br><span class="line">1756</span><br><span class="line">1757</span><br><span class="line">1758</span><br><span class="line">1759</span><br><span class="line">1760</span><br><span class="line">1761</span><br><span class="line">1762</span><br><span class="line">1763</span><br><span class="line">1764</span><br><span class="line">1765</span><br><span class="line">1766</span><br><span class="line">1767</span><br><span class="line">1768</span><br><span class="line">1769</span><br><span class="line">1770</span><br><span class="line">1771</span><br><span class="line">1772</span><br><span class="line">1773</span><br><span class="line">1774</span><br><span class="line">1775</span><br><span class="line">1776</span><br><span class="line">1777</span><br><span class="line">1778</span><br><span class="line">1779</span><br><span class="line">1780</span><br><span class="line">1781</span><br><span class="line">1782</span><br><span class="line">1783</span><br><span class="line">1784</span><br><span class="line">1785</span><br><span class="line">1786</span><br><span class="line">1787</span><br><span class="line">1788</span><br><span class="line">1789</span><br><span class="line">1790</span><br><span class="line">1791</span><br><span class="line">1792</span><br><span class="line">1793</span><br><span class="line">1794</span><br><span class="line">1795</span><br><span class="line">1796</span><br><span class="line">1797</span><br><span class="line">1798</span><br><span class="line">1799</span><br><span class="line">1800</span><br><span class="line">1801</span><br><span class="line">1802</span><br><span class="line">1803</span><br><span class="line">1804</span><br><span class="line">1805</span><br><span class="line">1806</span><br><span class="line">1807</span><br><span class="line">1808</span><br><span class="line">1809</span><br><span class="line">1810</span><br><span class="line">1811</span><br><span class="line">1812</span><br><span class="line">1813</span><br><span class="line">1814</span><br><span class="line">1815</span><br><span class="line">1816</span><br><span class="line">1817</span><br><span class="line">1818</span><br><span class="line">1819</span><br><span class="line">1820</span><br><span class="line">1821</span><br><span class="line">1822</span><br><span class="line">1823</span><br><span class="line">1824</span><br><span class="line">1825</span><br><span class="line">1826</span><br><span class="line">1827</span><br><span class="line">1828</span><br><span class="line">1829</span><br><span class="line">1830</span><br><span class="line">1831</span><br><span class="line">1832</span><br><span class="line">1833</span><br><span class="line">1834</span><br><span class="line">1835</span><br><span class="line">1836</span><br><span class="line">1837</span><br><span class="line">1838</span><br><span class="line">1839</span><br><span class="line">1840</span><br><span class="line">1841</span><br><span class="line">1842</span><br><span class="line">1843</span><br><span class="line">1844</span><br><span class="line">1845</span><br><span class="line">1846</span><br><span class="line">1847</span><br><span class="line">1848</span><br><span class="line">1849</span><br><span class="line">1850</span><br><span class="line">1851</span><br><span class="line">1852</span><br><span class="line">1853</span><br><span class="line">1854</span><br><span class="line">1855</span><br><span class="line">1856</span><br><span class="line">1857</span><br><span class="line">1858</span><br><span class="line">1859</span><br><span class="line">1860</span><br><span class="line">1861</span><br><span class="line">1862</span><br><span class="line">1863</span><br><span class="line">1864</span><br><span class="line">1865</span><br><span class="line">1866</span><br><span class="line">1867</span><br><span class="line">1868</span><br><span class="line">1869</span><br><span class="line">1870</span><br><span class="line">1871</span><br><span class="line">1872</span><br><span class="line">1873</span><br><span class="line">1874</span><br><span class="line">1875</span><br><span class="line">1876</span><br><span class="line">1877</span><br><span class="line">1878</span><br><span class="line">1879</span><br><span class="line">1880</span><br><span class="line">1881</span><br><span class="line">1882</span><br><span class="line">1883</span><br><span class="line">1884</span><br><span class="line">1885</span><br><span class="line">1886</span><br><span class="line">1887</span><br><span class="line">1888</span><br><span class="line">1889</span><br><span class="line">1890</span><br><span class="line">1891</span><br><span class="line">1892</span><br><span class="line">1893</span><br><span class="line">1894</span><br><span class="line">1895</span><br><span class="line">1896</span><br><span class="line">1897</span><br><span class="line">1898</span><br><span class="line">1899</span><br><span class="line">1900</span><br><span class="line">1901</span><br><span class="line">1902</span><br><span class="line">1903</span><br><span class="line">1904</span><br><span class="line">1905</span><br><span class="line">1906</span><br><span class="line">1907</span><br><span class="line">1908</span><br><span class="line">1909</span><br><span class="line">1910</span><br><span class="line">1911</span><br><span class="line">1912</span><br><span class="line">1913</span><br><span class="line">1914</span><br><span class="line">1915</span><br><span class="line">1916</span><br><span class="line">1917</span><br><span class="line">1918</span><br><span class="line">1919</span><br><span class="line">1920</span><br><span class="line">1921</span><br><span class="line">1922</span><br><span class="line">1923</span><br><span class="line">1924</span><br><span class="line">1925</span><br><span class="line">1926</span><br><span class="line">1927</span><br><span class="line">1928</span><br><span class="line">1929</span><br><span class="line">1930</span><br><span class="line">1931</span><br><span class="line">1932</span><br><span class="line">1933</span><br><span class="line">1934</span><br><span class="line">1935</span><br><span class="line">1936</span><br><span class="line">1937</span><br><span class="line">1938</span><br><span class="line">1939</span><br><span class="line">1940</span><br><span class="line">1941</span><br><span class="line">1942</span><br><span class="line">1943</span><br><span class="line">1944</span><br><span class="line">1945</span><br><span class="line">1946</span><br><span class="line">1947</span><br><span class="line">1948</span><br><span class="line">1949</span><br><span class="line">1950</span><br><span class="line">1951</span><br><span class="line">1952</span><br><span class="line">1953</span><br><span class="line">1954</span><br><span class="line">1955</span><br><span class="line">1956</span><br><span class="line">1957</span><br><span class="line">1958</span><br><span class="line">1959</span><br><span class="line">1960</span><br><span class="line">1961</span><br><span class="line">1962</span><br><span class="line">1963</span><br><span class="line">1964</span><br><span class="line">1965</span><br><span class="line">1966</span><br><span class="line">1967</span><br><span class="line">1968</span><br><span class="line">1969</span><br><span class="line">1970</span><br><span class="line">1971</span><br><span class="line">1972</span><br><span class="line">1973</span><br><span class="line">1974</span><br><span class="line">1975</span><br><span class="line">1976</span><br><span class="line">1977</span><br><span class="line">1978</span><br><span class="line">1979</span><br><span class="line">1980</span><br><span class="line">1981</span><br><span class="line">1982</span><br><span class="line">1983</span><br><span class="line">1984</span><br><span class="line">1985</span><br><span class="line">1986</span><br><span class="line">1987</span><br><span class="line">1988</span><br><span class="line">1989</span><br><span class="line">1990</span><br><span class="line">1991</span><br><span class="line">1992</span><br><span class="line">1993</span><br><span class="line">1994</span><br><span class="line">1995</span><br><span class="line">1996</span><br><span class="line">1997</span><br><span class="line">1998</span><br><span class="line">1999</span><br><span class="line">2000</span><br><span class="line">2001</span><br><span class="line">2002</span><br><span class="line">2003</span><br><span class="line">2004</span><br><span class="line">2005</span><br><span class="line">2006</span><br><span class="line">2007</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Zepto v1.0-1-ga3cab6c - polyfill zepto detect event ajax form fx - zeptojs.com/license */</span></span><br><span class="line">;(<span class="keyword">function</span>(<span class="params"><span class="literal">undefined</span></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">trim</span> === <span class="literal">undefined</span>) <span class="comment">// fix for iOS 3.2</span></span><br><span class="line">  <span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">trim</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">replace</span>(<span class="regexp">/^\s+|\s+$/g</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// For iOS 3.x</span></span><br><span class="line">  <span class="comment">// from https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/reduce</span></span><br><span class="line">  <span class="comment">//这个方法的作用就是累似一个累计处理的作用，将前一条数据的处理结果用作下一次的处理</span></span><br><span class="line">  <span class="comment">//比如[1,2,3,4,].reduce(function(x,y)&#123; return x+y&#125;); ==&gt; ((1+2)+3)+4,</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">reduce</span> === <span class="literal">undefined</span>) <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">reduce</span> = <span class="keyword">function</span>(<span class="params">fun</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span> === <span class="keyword">void</span> <span class="number">0</span> || <span class="variable language_">this</span> === <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>()</span><br><span class="line">    <span class="keyword">var</span> t = <span class="title class_">Object</span>(<span class="variable language_">this</span>),</span><br><span class="line">      len = t.<span class="property">length</span> &gt;&gt;&gt; <span class="number">0</span>,</span><br><span class="line">      k = <span class="number">0</span>,</span><br><span class="line">      accumulator</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> fun != <span class="string">&#x27;function&#x27;</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>()</span><br><span class="line">    <span class="keyword">if</span> (len == <span class="number">0</span> &amp;&amp; <span class="variable language_">arguments</span>.<span class="property">length</span> == <span class="number">1</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>()</span><br><span class="line">    <span class="comment">//取初始值  </span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> &gt;= <span class="number">2</span>) accumulator = <span class="variable language_">arguments</span>[<span class="number">1</span>] <span class="comment">//如果参数长度大于2个，则将第二个参数作为初始值</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">do</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (k <span class="keyword">in</span> t) &#123;</span><br><span class="line">        accumulator = t[k++] <span class="comment">//否则将数组的第一条数据作为初绍值</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (++k &gt;= len) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>() <span class="comment">//什么情况下会执行到这里来？？？</span></span><br><span class="line">    &#125; <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    <span class="comment">//遍历数组，将前一次的结果传入处理函数进行累计处理</span></span><br><span class="line">    <span class="keyword">while</span> (k &lt; len) &#123;</span><br><span class="line">      <span class="keyword">if</span> (k <span class="keyword">in</span> t) accumulator = fun.<span class="title function_">call</span>(<span class="literal">undefined</span>, accumulator, t[k], k, t)</span><br><span class="line">      k++</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> accumulator</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Zepto</span> = (<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> <span class="literal">undefined</span>, key, $, classList, emptyArray = [],</span><br><span class="line">    slice = emptyArray.<span class="property">slice</span>,</span><br><span class="line">    filter = emptyArray.<span class="property">filter</span>,</span><br><span class="line">    <span class="variable language_">document</span> = <span class="variable language_">window</span>.<span class="property">document</span>,</span><br><span class="line">    elementDisplay = &#123;&#125;, classCache = &#123;&#125;,</span><br><span class="line">    getComputedStyle = <span class="variable language_">document</span>.<span class="property">defaultView</span>.<span class="property">getComputedStyle</span>,</span><br><span class="line">    <span class="comment">//设置CSS时，不用加px单位的属性</span></span><br><span class="line">    cssNumber = &#123;</span><br><span class="line">      <span class="string">&#x27;column-count&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="string">&#x27;columns&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="string">&#x27;font-weight&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="string">&#x27;line-height&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="string">&#x27;opacity&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="string">&#x27;z-index&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="string">&#x27;zoom&#x27;</span>: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//HTML代码片断的正则</span></span><br><span class="line">    fragmentRE = <span class="regexp">/^\s*&lt;(\w+|!)[^&gt;]*&gt;/</span>,</span><br><span class="line">    <span class="comment">//匹配非单独一个闭合标签的标签，类似将&lt;div&gt;&lt;/div&gt;写成了&lt;div/&gt;</span></span><br><span class="line">    tagExpanderRE = <span class="regexp">/&lt;(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^&gt;]*)\/&gt;/ig</span>,</span><br><span class="line">    <span class="comment">//根节点</span></span><br><span class="line">    rootNodeRE = <span class="regexp">/^(?:body|html)$/i</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//需要提供get和set的方法名</span></span><br><span class="line">    <span class="comment">// special attributes that should be get/set via method calls</span></span><br><span class="line">    methodAttributes = [<span class="string">&#x27;val&#x27;</span>, <span class="string">&#x27;css&#x27;</span>, <span class="string">&#x27;html&#x27;</span>, <span class="string">&#x27;text&#x27;</span>, <span class="string">&#x27;data&#x27;</span>, <span class="string">&#x27;width&#x27;</span>, <span class="string">&#x27;height&#x27;</span>, <span class="string">&#x27;offset&#x27;</span>],</span><br><span class="line">    <span class="comment">//相邻节点的一些操作</span></span><br><span class="line">    adjacencyOperators = [<span class="string">&#x27;after&#x27;</span>, <span class="string">&#x27;prepend&#x27;</span>, <span class="string">&#x27;before&#x27;</span>, <span class="string">&#x27;append&#x27;</span>],</span><br><span class="line">    table = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;table&#x27;</span>),</span><br><span class="line">    tableRow = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;tr&#x27;</span>),</span><br><span class="line">    <span class="comment">//这里的用途是当需要给tr,tbody,thead,tfoot,td,th设置innerHTMl的时候，需要用其父元素作为容器来装载HTML字符串</span></span><br><span class="line">    containers = &#123;</span><br><span class="line">      <span class="string">&#x27;tr&#x27;</span>: <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;tbody&#x27;</span>),</span><br><span class="line">      <span class="string">&#x27;tbody&#x27;</span>: table,</span><br><span class="line">      <span class="string">&#x27;thead&#x27;</span>: table,</span><br><span class="line">      <span class="string">&#x27;tfoot&#x27;</span>: table,</span><br><span class="line">      <span class="string">&#x27;td&#x27;</span>: tableRow,</span><br><span class="line">      <span class="string">&#x27;th&#x27;</span>: tableRow,</span><br><span class="line">      <span class="string">&#x27;*&#x27;</span>: <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//当DOM ready的时候，document会有以下三种状态的一种</span></span><br><span class="line">    readyRE = <span class="regexp">/complete|loaded|interactive/</span>,</span><br><span class="line">    <span class="comment">//class选择器的正则</span></span><br><span class="line">    classSelectorRE = <span class="regexp">/^\.([\w-]+)$/</span>,</span><br><span class="line">    <span class="comment">//id选择器的正则</span></span><br><span class="line">    idSelectorRE = <span class="regexp">/^#([\w-]*)$/</span>,</span><br><span class="line">    <span class="comment">//DOM标签正则</span></span><br><span class="line">    tagSelectorRE = <span class="regexp">/^[\w-]+$/</span>,</span><br><span class="line">    class2type = &#123;&#125;,</span><br><span class="line">    toString = class2type.<span class="property">toString</span>,</span><br><span class="line">    zepto = &#123;&#125;,</span><br><span class="line">    camelize, uniq,</span><br><span class="line">    tempParent = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//判断一个元素是否匹配给定的选择器</span></span><br><span class="line">  zepto.<span class="property">matches</span> = <span class="keyword">function</span>(<span class="params">element, selector</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!element || element.<span class="property">nodeType</span> !== <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment">//引用浏览器提供的MatchesSelector方法</span></span><br><span class="line">    <span class="keyword">var</span> matchesSelector = element.<span class="property">webkitMatchesSelector</span> || element.<span class="property">mozMatchesSelector</span> || element.<span class="property">oMatchesSelector</span> || element.<span class="property">matchesSelector</span></span><br><span class="line">    <span class="keyword">if</span> (matchesSelector) <span class="keyword">return</span> matchesSelector.<span class="title function_">call</span>(element, selector);</span><br><span class="line">    <span class="comment">//如果浏览器不支持MatchesSelector方法，则将节点放入一个临时div节点，</span></span><br><span class="line">    <span class="comment">//再通过selector来查找这个div下的节点集，再判断给定的element是否在节点集中，如果在，则返回一个非零(即非false)的数字</span></span><br><span class="line">    <span class="comment">// fall back to performing a selector:</span></span><br><span class="line">    <span class="keyword">var</span> match, parent = element.<span class="property">parentNode</span>,temp = !parent</span><br><span class="line">    <span class="comment">//当element没有父节点，那么将其插入到一个临时的div里面</span></span><br><span class="line">    <span class="keyword">if</span> (temp)(parent = tempParent).<span class="title function_">appendChild</span>(element)</span><br><span class="line">    <span class="comment">//将parent作为上下文，来查找selector的匹配结果，并获取element在结果集的索引，不存在时为－1,再通过~-1转成0，存在时返回一个非零的值</span></span><br><span class="line">    match = ~zepto.<span class="title function_">qsa</span>(parent, selector).<span class="title function_">indexOf</span>(element)</span><br><span class="line">    <span class="comment">//将插入的节点删掉</span></span><br><span class="line">    temp &amp;&amp; tempParent.<span class="title function_">removeChild</span>(element)</span><br><span class="line">    <span class="keyword">return</span> match</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//获取对象类型 </span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">type</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="comment">//obj为null或者undefined时，直接返回&#x27;null&#x27;或&#x27;undefined&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> obj == <span class="literal">null</span> ? <span class="title class_">String</span>(obj) : class2type[toString.<span class="title function_">call</span>(obj)] || <span class="string">&quot;object&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">isFunction</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">type</span>(value) == <span class="string">&quot;function&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">isWindow</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> obj != <span class="literal">null</span> &amp;&amp; obj == obj.<span class="property">window</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">isDocument</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> obj != <span class="literal">null</span> &amp;&amp; obj.<span class="property">nodeType</span> == obj.<span class="property">DOCUMENT_NODE</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">isObject</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">type</span>(obj) == <span class="string">&quot;object&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//对于通过字面量定义的对象和new Object的对象返回true，new Object时传参数的返回false</span></span><br><span class="line">  <span class="comment">//可参考http://snandy.iteye.com/blog/663245</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">isPlainObject</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">isObject</span>(obj) &amp;&amp; !<span class="title function_">isWindow</span>(obj) &amp;&amp; obj.<span class="property">__proto__</span> == <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">isArray</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> value <span class="keyword">instanceof</span> <span class="title class_">Array</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//类数组，比如nodeList，这个只是做最简单的判断，如果给一个对象定义一个值为数据的length属性，它同样会返回true</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">likeArray</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> obj.<span class="property">length</span> == <span class="string">&#x27;number&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//清除给定的参数中的null或undefined，注意0==null,&#x27;&#x27; == null为false</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">compact</span>(<span class="params">array</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> filter.<span class="title function_">call</span>(array, <span class="keyword">function</span>(<span class="params">item</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> item != <span class="literal">null</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//类似得到一个数组的副本</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">flatten</span>(<span class="params">array</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> array.<span class="property">length</span> &gt; <span class="number">0</span> ? $.fn.<span class="property">concat</span>.<span class="title function_">apply</span>([], array) : array</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//将字符串转成驼峰式的格式</span></span><br><span class="line">  camelize = <span class="keyword">function</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> str.<span class="title function_">replace</span>(<span class="regexp">/-+(.)?/g</span>, <span class="keyword">function</span>(<span class="params">match, chr</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> chr ? chr.<span class="title function_">toUpperCase</span>() : <span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//将字符串格式化成-拼接的形式,一般用在样式属性上，比如border-width</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">dasherize</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> str.<span class="title function_">replace</span>(<span class="regexp">/::/g</span>, <span class="string">&#x27;/&#x27;</span>) <span class="comment">//将：：替换成/</span></span><br><span class="line">    .<span class="title function_">replace</span>(<span class="regexp">/([A-Z]+)([A-Z][a-z])/g</span>, <span class="string">&#x27;$1_$2&#x27;</span>) <span class="comment">//在大小写字符之间插入_,大写在前，比如AAAbb,得到AA_Abb</span></span><br><span class="line">    .<span class="title function_">replace</span>(<span class="regexp">/([a-z\d])([A-Z])/g</span>, <span class="string">&#x27;$1_$2&#x27;</span>) <span class="comment">//在大小写字符之间插入_,小写或数字在前，比如bbbAaa,得到bbb_Aaa</span></span><br><span class="line">    .<span class="title function_">replace</span>(<span class="regexp">/_/g</span>, <span class="string">&#x27;-&#x27;</span>) <span class="comment">//将_替换成-</span></span><br><span class="line">    .<span class="title function_">toLowerCase</span>() <span class="comment">//转成小写</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//数组去重，如果该条数据在数组中的位置与循环的索引值不相同，则说明数组中有与其相同的值</span></span><br><span class="line">  uniq = <span class="keyword">function</span>(<span class="params">array</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> filter.<span class="title function_">call</span>(array, <span class="keyword">function</span>(<span class="params">item, idx</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> array.<span class="title function_">indexOf</span>(item) == idx</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//将给定的参数生成正则</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">classRE</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="comment">//classCache,缓存正则</span></span><br><span class="line">    <span class="keyword">return</span> name <span class="keyword">in</span> classCache ? classCache[name] : (classCache[name] = <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&#x27;(^|\\s)&#x27;</span> + name + <span class="string">&#x27;(\\s|$)&#x27;</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//给需要的样式值后面加上&#x27;px&#x27;单位，除了cssNumber里面的指定的那些</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">maybeAddPx</span>(<span class="params">name, value</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">typeof</span> value == <span class="string">&quot;number&quot;</span> &amp;&amp; !cssNumber[<span class="title function_">dasherize</span>(name)]) ? value + <span class="string">&quot;px&quot;</span> : value</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//获取节点的默认display属性</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">defaultDisplay</span>(<span class="params">nodeName</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> element, display</span><br><span class="line">    <span class="keyword">if</span> (!elementDisplay[nodeName]) &#123; <span class="comment">//缓存里不存在</span></span><br><span class="line">      element = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(nodeName)</span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(element)</span><br><span class="line">      display = <span class="title function_">getComputedStyle</span>(element, <span class="string">&#x27;&#x27;</span>).<span class="title function_">getPropertyValue</span>(<span class="string">&quot;display&quot;</span>)</span><br><span class="line">      element.<span class="property">parentNode</span>.<span class="title function_">removeChild</span>(element)</span><br><span class="line">      display == <span class="string">&quot;none&quot;</span> &amp;&amp; (display = <span class="string">&quot;block&quot;</span>) <span class="comment">//当display等于none时，设置其值为block, 701行show函数调用</span></span><br><span class="line">      elementDisplay[nodeName] = display <span class="comment">//缓存元素的默认display属性</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> elementDisplay[nodeName]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//获取指定元素的子节点(不包含文本节点),Firefox不支持children，所以只能通过筛选childNodes</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">children</span>(<span class="params">element</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;children&#x27;</span> <span class="keyword">in</span> element ? slice.<span class="title function_">call</span>(element.<span class="property">children</span>) : $.<span class="title function_">map</span>(element.<span class="property">childNodes</span>, <span class="keyword">function</span>(<span class="params">node</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (node.<span class="property">nodeType</span> == <span class="number">1</span>) <span class="keyword">return</span> node</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.fragment` takes a html string and an optional tag name</span></span><br><span class="line">  <span class="comment">// to generate DOM nodes nodes from the given html string.</span></span><br><span class="line">  <span class="comment">// The generated DOM nodes are returned as an array.</span></span><br><span class="line">  <span class="comment">// This function can be overriden in plugins for example to make</span></span><br><span class="line">  <span class="comment">// it compatible with browsers that don&#x27;t support the DOM fully.</span></span><br><span class="line">  zepto.<span class="property">fragment</span> = <span class="keyword">function</span>(<span class="params">html, name, properties</span>) &#123;</span><br><span class="line">    <span class="comment">//将类似&lt;div class=&quot;test&quot;/&gt;替换成&lt;div class=&quot;test&quot;&gt;&lt;/div&gt;,算是一种修复吧</span></span><br><span class="line">    <span class="keyword">if</span> (html.<span class="property">replace</span>) html = html.<span class="title function_">replace</span>(tagExpanderRE, <span class="string">&quot;&lt;$1&gt;&lt;/$2&gt;&quot;</span>)</span><br><span class="line">    <span class="comment">//给name取标签名</span></span><br><span class="line">    <span class="keyword">if</span> (name === <span class="literal">undefined</span>) name = fragmentRE.<span class="title function_">test</span>(html) &amp;&amp; <span class="title class_">RegExp</span>.<span class="property">$1</span></span><br><span class="line">    <span class="comment">//设置容器标签名，如果不是tr,tbody,thead,tfoot,td,th，则容器标签名为div</span></span><br><span class="line">    <span class="keyword">if</span> (!(name <span class="keyword">in</span> containers)) name = <span class="string">&#x27;*&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> nodes, dom, container = containers[name] <span class="comment">//创建容器</span></span><br><span class="line">    container.<span class="property">innerHTML</span> = <span class="string">&#x27;&#x27;</span> + html <span class="comment">//将html代码片断放入容器</span></span><br><span class="line">    <span class="comment">//取容器的子节点，这样就直接把字符串转成DOM节点了</span></span><br><span class="line">    dom = $.<span class="title function_">each</span>(slice.<span class="title function_">call</span>(container.<span class="property">childNodes</span>), <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      container.<span class="title function_">removeChild</span>(<span class="variable language_">this</span>) <span class="comment">//逐个删除</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">//如果properties是对象, 则将其当作属性来给添加进来的节点进行设置</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(properties)) &#123;</span><br><span class="line">      nodes = $(dom) <span class="comment">//将dom转成zepto对象，为了方便下面调用zepto上的方法</span></span><br><span class="line">      <span class="comment">//遍历对象，设置属性</span></span><br><span class="line">      $.<span class="title function_">each</span>(properties, <span class="keyword">function</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">        <span class="comment">//如果设置的是&#x27;val&#x27;, &#x27;css&#x27;, &#x27;html&#x27;, &#x27;text&#x27;, &#x27;data&#x27;, &#x27;width&#x27;, &#x27;height&#x27;, &#x27;offset&#x27;，则调用zepto上相对应的方法</span></span><br><span class="line">        <span class="keyword">if</span> (methodAttributes.<span class="title function_">indexOf</span>(key) &gt; -<span class="number">1</span>) nodes[key](value)</span><br><span class="line">        <span class="keyword">else</span> nodes.<span class="title function_">attr</span>(key, value)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//返回将字符串转成的DOM节点后的数组，比如&#x27;&lt;li&gt;&lt;/li&gt;&lt;li&gt;&lt;/li&gt;&lt;li&gt;&lt;/li&gt;&#x27;转成[li,li,li]</span></span><br><span class="line">    <span class="keyword">return</span> dom</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.Z` swaps out the prototype of the given `dom` array</span></span><br><span class="line">  <span class="comment">// of nodes with `$.fn` and thus supplying all the Zepto functions</span></span><br><span class="line">  <span class="comment">// to the array. Note that `__proto__` is not supported on Internet</span></span><br><span class="line">  <span class="comment">// Explorer. This method can be overriden in plugins.</span></span><br><span class="line">  zepto.<span class="property">Z</span> = <span class="keyword">function</span>(<span class="params">dom, selector</span>) &#123;</span><br><span class="line">    dom = dom || []</span><br><span class="line">    dom.<span class="property">__proto__</span> = $.fn <span class="comment">//通过给dom设置__proto__属性指向$.fn来达到继承$.fn上所有方法的目的</span></span><br><span class="line">    dom.<span class="property">selector</span> = selector || <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> dom</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.isZ` should return `true` if the given object is a Zepto</span></span><br><span class="line">  <span class="comment">// collection. This method can be overriden in plugins.</span></span><br><span class="line">  <span class="comment">//判断给定的参数是否是Zepto集</span></span><br><span class="line">  zepto.<span class="property">isZ</span> = <span class="keyword">function</span>(<span class="params">object</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> object <span class="keyword">instanceof</span> zepto.<span class="property">Z</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.init` is Zepto&#x27;s counterpart to jQuery&#x27;s `$.fn.init` and</span></span><br><span class="line">  <span class="comment">// takes a CSS selector and an optional context (and handles various</span></span><br><span class="line">  <span class="comment">// special cases).</span></span><br><span class="line">  <span class="comment">// This method can be overriden in plugins.</span></span><br><span class="line">  zepto.<span class="property">init</span> = <span class="keyword">function</span>(<span class="params">selector, context</span>) &#123;</span><br><span class="line">    <span class="comment">// If nothing given, return an empty Zepto collection</span></span><br><span class="line">    <span class="keyword">if</span> (!selector) <span class="keyword">return</span> zepto.<span class="title function_">Z</span>() <span class="comment">//没有参数，返回空数组</span></span><br><span class="line">    <span class="comment">//如果selector是个函数，则在DOM ready的时候执行它</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isFunction</span>(selector)) <span class="keyword">return</span> $(<span class="variable language_">document</span>).<span class="title function_">ready</span>(selector)</span><br><span class="line">    <span class="comment">//如果selector是一个zepto.Z实例，则直接返回它自己</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (zepto.<span class="title function_">isZ</span>(selector)) <span class="keyword">return</span> selector</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">var</span> dom</span><br><span class="line">      <span class="comment">//如果selector是一个数组，则将其里面的null,undefined去掉</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isArray</span>(selector)) dom = <span class="title function_">compact</span>(selector)</span><br><span class="line">      <span class="comment">//如果selector是个对象，注意DOM节点的typeof值也是object，所以在里面还要再进行一次判断</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isObject</span>(selector))</span><br><span class="line">      <span class="comment">//如果是申明的对象，如&#123;&#125;， 则将selector属性copy到一个新对象，并将结果放入数组</span></span><br><span class="line">      <span class="comment">//如果是该对象是DOM，则直接放到数组中</span></span><br><span class="line">      dom = [<span class="title function_">isPlainObject</span>(selector) ? $.<span class="title function_">extend</span>(&#123;&#125;, selector) : selector], selector = <span class="literal">null</span></span><br><span class="line">      <span class="comment">//如果selector是一段HTML代码片断，则将其转换成DOM节点</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (fragmentRE.<span class="title function_">test</span>(selector)) dom = zepto.<span class="title function_">fragment</span>(selector.<span class="title function_">trim</span>(), <span class="title class_">RegExp</span>.<span class="property">$1</span>, context), selector = <span class="literal">null</span></span><br><span class="line">      <span class="comment">//如果存在上下文context，则在上下文中查找selector，此时的selector为普通的CSS选择器</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (context !== <span class="literal">undefined</span>) <span class="keyword">return</span> $(context).<span class="title function_">find</span>(selector)</span><br><span class="line">      <span class="comment">//如果没有给定上下文，则在document中查找selector，此时的selector为普通的CSS选择器</span></span><br><span class="line">      <span class="keyword">else</span> dom = zepto.<span class="title function_">qsa</span>(<span class="variable language_">document</span>, selector)</span><br><span class="line">      <span class="comment">//最后将查询结果转换成zepto集合</span></span><br><span class="line">      <span class="keyword">return</span> zepto.<span class="title function_">Z</span>(dom, selector)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$` will be the base `Zepto` object. When calling this</span></span><br><span class="line">  <span class="comment">// function just call `$.zepto.init, which makes the implementation</span></span><br><span class="line">  <span class="comment">// details of selecting nodes and creating Zepto collections</span></span><br><span class="line">  <span class="comment">// patchable in plugins.</span></span><br><span class="line">  $ = <span class="keyword">function</span>(<span class="params">selector, context</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> zepto.<span class="title function_">init</span>(selector, context)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//扩展，deep表示是否深度扩展</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">extend</span>(<span class="params">target, source, deep</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (key <span class="keyword">in</span> source)</span><br><span class="line">    <span class="comment">//如果深度扩展</span></span><br><span class="line">    <span class="keyword">if</span> (deep &amp;&amp; (<span class="title function_">isPlainObject</span>(source[key]) || <span class="title function_">isArray</span>(source[key]))) &#123;</span><br><span class="line">      <span class="comment">//如果要扩展的数据是对象且target相对应的key不是对象</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isPlainObject</span>(source[key]) &amp;&amp; !<span class="title function_">isPlainObject</span>(target[key])) target[key] = &#123;&#125;</span><br><span class="line">      <span class="comment">//如果要扩展的数据是数组且target相对应的key不是数组</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isArray</span>(source[key]) &amp;&amp; !<span class="title function_">isArray</span>(target[key])) target[key] = []</span><br><span class="line">      <span class="title function_">extend</span>(target[key], source[key], deep)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (source[key] !== <span class="literal">undefined</span>) target[key] = source[key]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Copy all but undefined properties from one or more</span></span><br><span class="line">  <span class="comment">// objects to the `target` object.</span></span><br><span class="line">  $.extend = <span class="keyword">function</span>(<span class="params">target</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> deep, args = slice.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> target == <span class="string">&#x27;boolean&#x27;</span>) &#123; <span class="comment">//当第一个参数为boolean类型的值时，表示是否深度扩展</span></span><br><span class="line">      deep = target</span><br><span class="line">      target = args.<span class="title function_">shift</span>() <span class="comment">//target取第二个参数</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//遍历后面的参数，全部扩展到target上</span></span><br><span class="line">    args.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">arg</span>) &#123;</span><br><span class="line">      <span class="title function_">extend</span>(target, arg, deep)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// `$.zepto.qsa` is Zepto&#x27;s CSS selector implementation which</span></span><br><span class="line">  <span class="comment">// uses `document.querySelectorAll` and optimizes for some special cases, like `#id`.</span></span><br><span class="line">  <span class="comment">// This method can be overriden in plugins.</span></span><br><span class="line">  zepto.<span class="property">qsa</span> = <span class="keyword">function</span>(<span class="params">element, selector</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> found</span><br><span class="line">    <span class="comment">//当element为document,且selector为ID选择器时</span></span><br><span class="line">    <span class="keyword">return</span> (<span class="title function_">isDocument</span>(element) &amp;&amp; idSelectorRE.<span class="title function_">test</span>(selector)) ?</span><br><span class="line">    <span class="comment">//直接返回document.getElementById,RegExp.$1为ID的值,当没有找节点时返回[]</span></span><br><span class="line">    ((found = element.<span class="title function_">getElementById</span>(<span class="title class_">RegExp</span>.<span class="property">$1</span>)) ? [found] : []) :</span><br><span class="line">    <span class="comment">//当element不为元素节点或者document时，返回[]</span></span><br><span class="line">    (element.<span class="property">nodeType</span> !== <span class="number">1</span> &amp;&amp; element.<span class="property">nodeType</span> !== <span class="number">9</span>) ? [] :</span><br><span class="line">    <span class="comment">//否则将获取到的结果转成数组并返回</span></span><br><span class="line">    slice.<span class="title function_">call</span>(</span><br><span class="line">    <span class="comment">//如果selector是标签名,直接调用getElementsByClassName</span></span><br><span class="line">    classSelectorRE.<span class="title function_">test</span>(selector) ? element.<span class="title function_">getElementsByClassName</span>(<span class="title class_">RegExp</span>.<span class="property">$1</span>) :</span><br><span class="line">    <span class="comment">//如果selector是标签名,直接调用getElementsByTagName</span></span><br><span class="line">    tagSelectorRE.<span class="title function_">test</span>(selector) ? element.<span class="title function_">getElementsByTagName</span>(selector) :</span><br><span class="line">    <span class="comment">//否则调用querySelectorAll</span></span><br><span class="line">    element.<span class="title function_">querySelectorAll</span>(selector))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//在结果中进行过滤</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">filtered</span>(<span class="params">nodes, selector</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> selector === <span class="literal">undefined</span> ? $(nodes) : $(nodes).<span class="title function_">filter</span>(selector)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//判断parent是否包含node</span></span><br><span class="line">  $.contains = <span class="keyword">function</span>(<span class="params">parent, node</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> parent !== node &amp;&amp; parent.<span class="title function_">contains</span>(node)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//这个函数在整个库中取着很得要的作用，处理arg为函数或者值的情况</span></span><br><span class="line">  <span class="comment">//下面很多设置元素属性时的函数都有用到</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">funcArg</span>(<span class="params">context, arg, idx, payload</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">isFunction</span>(arg) ? arg.<span class="title function_">call</span>(context, idx, payload) : arg</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">setAttribute</span>(<span class="params">node, name, value</span>) &#123;</span><br><span class="line">    <span class="comment">//如果设置的值为null或undefined,则相当于删除该属性，否则设置name属性为value</span></span><br><span class="line">    value == <span class="literal">null</span> ? node.<span class="title function_">removeAttribute</span>(name) : node.<span class="title function_">setAttribute</span>(name, value)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// access className property while respecting SVGAnimatedString</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">className</span>(<span class="params">node, value</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> klass = node.<span class="property">className</span>,</span><br><span class="line">      svg = klass &amp;&amp; klass.<span class="property">baseVal</span> !== <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (value === <span class="literal">undefined</span>) <span class="keyword">return</span> svg ? klass.<span class="property">baseVal</span> : klass</span><br><span class="line">    svg ? (klass.<span class="property">baseVal</span> = value) : (node.<span class="property">className</span> = value)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// &quot;true&quot;  =&gt; true</span></span><br><span class="line">  <span class="comment">// &quot;false&quot; =&gt; false</span></span><br><span class="line">  <span class="comment">// &quot;null&quot;  =&gt; null</span></span><br><span class="line">  <span class="comment">// &quot;42&quot;    =&gt; 42</span></span><br><span class="line">  <span class="comment">// &quot;42.5&quot;  =&gt; 42.5</span></span><br><span class="line">  <span class="comment">// JSON    =&gt; parse if valid</span></span><br><span class="line">  <span class="comment">// String  =&gt; self</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">deserializeValue</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> num</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> value ? value == <span class="string">&quot;true&quot;</span> || (value == <span class="string">&quot;false&quot;</span> ? <span class="literal">false</span> : value == <span class="string">&quot;null&quot;</span> ? <span class="literal">null</span> : !<span class="built_in">isNaN</span>(num = <span class="title class_">Number</span>(value)) ? num : <span class="regexp">/^[\[\&#123;]/</span>.<span class="title function_">test</span>(value) ? $.<span class="title function_">parseJSON</span>(value) : value) : value</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.type = type</span><br><span class="line">  $.isFunction = isFunction</span><br><span class="line">  $.isWindow = isWindow</span><br><span class="line">  $.isArray = isArray</span><br><span class="line">  $.isPlainObject = isPlainObject</span><br><span class="line"></span><br><span class="line">  <span class="comment">//空对象</span></span><br><span class="line">  $.isEmptyObject = <span class="keyword">function</span>(<span class="params">obj</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> name</span><br><span class="line">    <span class="keyword">for</span> (name <span class="keyword">in</span> obj) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//获取指定的值在数组中的位置</span></span><br><span class="line">  $.inArray = <span class="keyword">function</span>(<span class="params">elem, array, i</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> emptyArray.<span class="property">indexOf</span>.<span class="title function_">call</span>(array, elem, i)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//将字符串转成驼峰式的格式</span></span><br><span class="line">  $.camelCase = camelize</span><br><span class="line">  <span class="comment">//去字符串头尾空格</span></span><br><span class="line">  $.trim = <span class="keyword">function</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> str.<span class="title function_">trim</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// plugin compatibility</span></span><br><span class="line">  $.uuid = <span class="number">0</span></span><br><span class="line">  $.support = &#123;&#125;</span><br><span class="line">  $.expr = &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//遍历elements，将每条记录放入callback里进宪处理，保存处理函数返回值不为null或undefined的结果</span></span><br><span class="line">  <span class="comment">//注意这里没有统一的用for in,是为了避免遍历数据默认属性的情况，如数组的toString,valueOf</span></span><br><span class="line">  $.map = <span class="keyword">function</span>(<span class="params">elements, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> value, values = [],</span><br><span class="line">      i, key</span><br><span class="line">      <span class="comment">//如果被遍历的数据是数组或者nodeList</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">likeArray</span>(elements)) <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; elements.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      value = <span class="title function_">callback</span>(elements[i], i)</span><br><span class="line">      <span class="keyword">if</span> (value != <span class="literal">null</span>) values.<span class="title function_">push</span>(value)</span><br><span class="line">    &#125; <span class="keyword">else</span></span><br><span class="line">    <span class="comment">//如果是对象</span></span><br><span class="line">    <span class="keyword">for</span> (key <span class="keyword">in</span> elements) &#123;</span><br><span class="line">      value = <span class="title function_">callback</span>(elements[key], key)</span><br><span class="line">      <span class="keyword">if</span> (value != <span class="literal">null</span>) values.<span class="title function_">push</span>(value)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">flatten</span>(values)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//遍历数组，将每条数据作为callback的上下文，并传入数据以及数据的索引进行处理，如果其中一条数据的处理结果明确返回false，</span></span><br><span class="line">  <span class="comment">//则停止遍历，并返回elements</span></span><br><span class="line">  $.each = <span class="keyword">function</span>(<span class="params">elements, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> i, key</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">likeArray</span>(elements)) &#123;</span><br><span class="line">      <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; elements.<span class="property">length</span>; i++)</span><br><span class="line">      <span class="keyword">if</span> (callback.<span class="title function_">call</span>(elements[i], i, elements[i]) === <span class="literal">false</span>) <span class="keyword">return</span> elements</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (key <span class="keyword">in</span> elements)</span><br><span class="line">      <span class="keyword">if</span> (callback.<span class="title function_">call</span>(elements[key], key, elements[key]) === <span class="literal">false</span>) <span class="keyword">return</span> elements</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> elements</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//过滤</span></span><br><span class="line">  $.grep = <span class="keyword">function</span>(<span class="params">elements, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> filter.<span class="title function_">call</span>(elements, callback)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">JSON</span>) $.parseJSON = <span class="title class_">JSON</span>.<span class="property">parse</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Populate the class2type map</span></span><br><span class="line">  <span class="comment">//填充class2type的值</span></span><br><span class="line">  $.<span class="title function_">each</span>(<span class="string">&quot;Boolean Number String Function Array Date RegExp Object Error&quot;</span>.<span class="title function_">split</span>(<span class="string">&quot; &quot;</span>), <span class="keyword">function</span>(<span class="params">i, name</span>) &#123;</span><br><span class="line">    class2type[<span class="string">&quot;[object &quot;</span> + name + <span class="string">&quot;]&quot;</span>] = name.<span class="title function_">toLowerCase</span>()</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//针对DOM的一些操作</span></span><br><span class="line">  <span class="comment">// Define methods that will be available on all</span></span><br><span class="line">  <span class="comment">// Zepto collections</span></span><br><span class="line">  $.fn = &#123;</span><br><span class="line">    <span class="comment">// Because a collection acts like an array</span></span><br><span class="line">    <span class="comment">// copy over these useful array functions.</span></span><br><span class="line">    <span class="attr">forEach</span>: emptyArray.<span class="property">forEach</span>,</span><br><span class="line">    <span class="attr">reduce</span>: emptyArray.<span class="property">reduce</span>,</span><br><span class="line">    <span class="attr">push</span>: emptyArray.<span class="property">push</span>,</span><br><span class="line">    <span class="attr">sort</span>: emptyArray.<span class="property">sort</span>,</span><br><span class="line">    <span class="attr">indexOf</span>: emptyArray.<span class="property">indexOf</span>,</span><br><span class="line">    <span class="attr">concat</span>: emptyArray.<span class="property">concat</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// `map` and `slice` in the jQuery API work differently</span></span><br><span class="line">    <span class="comment">// from their array counterparts</span></span><br><span class="line">    <span class="attr">map</span>: <span class="keyword">function</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> $($.<span class="title function_">map</span>(<span class="variable language_">this</span>, <span class="keyword">function</span>(<span class="params">el, i</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> fn.<span class="title function_">call</span>(el, i, el)</span><br><span class="line">      &#125;))</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">slice</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> $(slice.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>))</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//DOM Ready</span></span><br><span class="line">    <span class="attr">ready</span>: <span class="keyword">function</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (readyRE.<span class="title function_">test</span>(<span class="variable language_">document</span>.<span class="property">readyState</span>)) <span class="title function_">callback</span>($)</span><br><span class="line">      <span class="keyword">else</span> <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">callback</span>($)</span><br><span class="line">      &#125;, <span class="literal">false</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//取集合中对应指定索引的值，如果idx小于0,则idx等于idx+length,length为集合的长度</span></span><br><span class="line">    <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params">idx</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> idx === <span class="literal">undefined</span> ? slice.<span class="title function_">call</span>(<span class="variable language_">this</span>) : <span class="variable language_">this</span>[idx &gt;= <span class="number">0</span> ? idx : idx + <span class="variable language_">this</span>.<span class="property">length</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//将集合转换为数组</span></span><br><span class="line">    <span class="attr">toArray</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">get</span>()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//获取集合长度</span></span><br><span class="line">    <span class="attr">size</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">length</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//将集合从dom中删除</span></span><br><span class="line">    <span class="attr">remove</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">parentNode</span> != <span class="literal">null</span>) <span class="variable language_">this</span>.<span class="property">parentNode</span>.<span class="title function_">removeChild</span>(<span class="variable language_">this</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//遍历集合，将集合中的每一项放入callback中进行处理，去掉结果为false的项，注意这里的callback如果明确返回false</span></span><br><span class="line">    <span class="comment">//那么就会停止循环了</span></span><br><span class="line">    <span class="attr">each</span>: <span class="keyword">function</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">      emptyArray.<span class="property">every</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="keyword">function</span>(<span class="params">el, idx</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> callback.<span class="title function_">call</span>(el, idx, el) !== <span class="literal">false</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//过滤集合，返回处理结果为true的记录</span></span><br><span class="line">    <span class="attr">filter</span>: <span class="keyword">function</span>(<span class="params">selector</span>) &#123;</span><br><span class="line">      <span class="comment">//this.not(selector)取到需要排除的集合，第二次再取反(这个时候this.not的参数就是一个集合了)，得到想要的集合</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isFunction</span>(selector)) <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">not</span>(<span class="variable language_">this</span>.<span class="title function_">not</span>(selector))</span><br><span class="line">      <span class="comment">//filter收集返回结果为true的记录</span></span><br><span class="line">      <span class="keyword">return</span> $(filter.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="keyword">function</span>(<span class="params">element</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> zepto.<span class="title function_">matches</span>(element, selector) <span class="comment">//当element与selector匹配，则收集</span></span><br><span class="line">      &#125;))</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//将由selector获取到的结果追加到当前集合中</span></span><br><span class="line">    <span class="attr">add</span>: <span class="keyword">function</span>(<span class="params">selector, context</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> $(<span class="title function_">uniq</span>(<span class="variable language_">this</span>.<span class="title function_">concat</span>($(selector, context)))) <span class="comment">//追加并去重</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//返回集合中的第1条记录是否与selector匹配</span></span><br><span class="line">    <span class="attr">is</span>: <span class="keyword">function</span>(<span class="params">selector</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">length</span> &gt; <span class="number">0</span> &amp;&amp; zepto.<span class="title function_">matches</span>(<span class="variable language_">this</span>[<span class="number">0</span>], selector)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//排除集合里满足条件的记录，接收参数为：css选择器，function, dom ,nodeList</span></span><br><span class="line">    <span class="attr">not</span>: <span class="keyword">function</span>(<span class="params">selector</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> nodes = []</span><br><span class="line">      <span class="comment">//当selector为函数时，safari下的typeof odeList也是function，所以这里需要再加一个判断selector.call !== undefined</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">isFunction</span>(selector) &amp;&amp; selector.<span class="property">call</span> !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">idx</span>) &#123;</span><br><span class="line">          <span class="comment">//注意这里收集的是selector.call(this,idx)返回结果为false的时候记录</span></span><br><span class="line">          <span class="keyword">if</span> (!selector.<span class="title function_">call</span>(<span class="variable language_">this</span>, idx)) nodes.<span class="title function_">push</span>(<span class="variable language_">this</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//当selector为字符串的时候，对集合进行筛选，也就是筛选出集合中满足selector的记录</span></span><br><span class="line">        <span class="keyword">var</span> excludes = <span class="keyword">typeof</span> selector == <span class="string">&#x27;string&#x27;</span> ? <span class="variable language_">this</span>.<span class="title function_">filter</span>(selector) :</span><br><span class="line">        <span class="comment">//当selector为nodeList时执行slice.call(selector),注意这里的isFunction(selector.item)是为了排除selector为数组的情况</span></span><br><span class="line">        <span class="comment">//当selector为css选择器，执行$(selector)</span></span><br><span class="line">        (<span class="title function_">likeArray</span>(selector) &amp;&amp; <span class="title function_">isFunction</span>(selector.<span class="property">item</span>)) ? slice.<span class="title function_">call</span>(selector) : $(selector)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">el</span>) &#123;</span><br><span class="line">          <span class="comment">//筛选出不在excludes集合里的记录，达到排除的目的</span></span><br><span class="line">          <span class="keyword">if</span> (excludes.<span class="title function_">indexOf</span>(el) &lt; <span class="number">0</span>) nodes.<span class="title function_">push</span>(el)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> $(nodes) <span class="comment">//由于上面得到的结果是数组，这里需要转成zepto对象，以便继承其它方法，实现链写</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        接收node和string作为参数，给当前集合筛选出包含selector的集合</span></span><br><span class="line"><span class="comment">        isObject(selector)是判断参数是否是node，因为typeof node == &#x27;object&#x27;</span></span><br><span class="line"><span class="comment">        当参数为node时，只需要判读当前记当里是否包含node节点即可</span></span><br><span class="line"><span class="comment">        当参数为string时，则在当前记录里查询selector，如果长度为0，则为false，filter函数就会过滤掉这条记录，否则保存该记录</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="attr">has</span>: <span class="keyword">function</span>(<span class="params">selector</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">filter</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">isObject</span>(selector) ? $.<span class="title function_">contains</span>(<span class="variable language_">this</span>, selector) : $(<span class="variable language_">this</span>).<span class="title function_">find</span>(selector).<span class="title function_">size</span>()</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">        选择集合中指定索引的记录，当idx为-1时，取最后一个记录</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="attr">eq</span>: <span class="keyword">function</span>(<span class="params">idx</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> idx === -<span class="number">1</span> ? <span class="variable language_">this</span>.<span class="title function_">slice</span>(idx) : <span class="variable language_">this</span>.<span class="title function_">slice</span>(idx, +idx + <span class="number">1</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">        取集合中的第一条记录</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="attr">first</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> el = <span class="variable language_">this</span>[<span class="number">0</span>] <span class="comment">//取集合中的第一条记录</span></span><br><span class="line">      <span class="comment">//如果集合中的第一条数据本身就已经是zepto对象则直接返回本身，否则转成zepto对象</span></span><br><span class="line">      <span class="comment">//el &amp;&amp; !isObject(el)在这里取到一个判断el是否为节点的情况，因为如果el是节点，那么isObject(el)的结果就是true</span></span><br><span class="line">      <span class="keyword">return</span> el &amp;&amp; !<span class="title function_">isObject</span>(el) ? el : $(el)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">        取集合中的最后一条记录</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="attr">last</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> el = <span class="variable language_">this</span>[<span class="variable language_">this</span>.<span class="property">length</span> - <span class="number">1</span>] <span class="comment">//取集合中的最后一条记录</span></span><br><span class="line">      <span class="comment">//如果el为node,则isObject(el)会为true,需要转成zepto对象</span></span><br><span class="line">      <span class="keyword">return</span> el &amp;&amp; !<span class="title function_">isObject</span>(el) ? el : $(el)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">        在当前集合中查找selector，selector可以是集合，选择器，以及节点</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="attr">find</span>: <span class="keyword">function</span>(<span class="params">selector</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> result, $this = <span class="variable language_">this</span></span><br><span class="line">      <span class="comment">//如果selector为node或者zepto集合时</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> selector == <span class="string">&#x27;object&#x27;</span>)</span><br><span class="line">      <span class="comment">//遍历selector，筛选出父级为集合中记录的selector</span></span><br><span class="line">      result = $(selector).<span class="title function_">filter</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> node = <span class="variable language_">this</span></span><br><span class="line">        <span class="comment">//如果$.contains(parent, node)返回true，则emptyArray.some也会返回true,外层的filter则会收录该条记录</span></span><br><span class="line">        <span class="keyword">return</span> emptyArray.<span class="property">some</span>.<span class="title function_">call</span>($this, <span class="keyword">function</span>(<span class="params">parent</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> $.<span class="title function_">contains</span>(parent, node)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">//如果selector是css选择器</span></span><br><span class="line">      <span class="comment">//如果当前集合长度为1时，调用zepto.qsa，将结果转成zepto对象</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">length</span> == <span class="number">1</span>) result = $(zepto.<span class="title function_">qsa</span>(<span class="variable language_">this</span>[<span class="number">0</span>], selector))</span><br><span class="line">      <span class="comment">//如果长度大于1，则调用map遍历</span></span><br><span class="line">      <span class="keyword">else</span> result = <span class="variable language_">this</span>.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> zepto.<span class="title function_">qsa</span>(<span class="variable language_">this</span>, selector)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//取集合中第一记录的最近的满足条件的父级元素</span></span><br><span class="line">    <span class="attr">closest</span>: <span class="keyword">function</span>(<span class="params">selector, context</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> node = <span class="variable language_">this</span>[<span class="number">0</span>],</span><br><span class="line">        collection = <span class="literal">false</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> selector == <span class="string">&#x27;object&#x27;</span>) collection = $(selector)</span><br><span class="line">      <span class="comment">//当selector是node或者zepto集合时，如果node不在collection集合中时需要取node.parentNode进行判断</span></span><br><span class="line">      <span class="comment">//当selector是字符串选择器时，如果node与selector不匹配，则需要取node.parentNode进行判断</span></span><br><span class="line">      <span class="keyword">while</span> (node &amp;&amp; !(collection ? collection.<span class="title function_">indexOf</span>(node) &gt;= <span class="number">0</span> : zepto.<span class="title function_">matches</span>(node, selector)))</span><br><span class="line">      <span class="comment">//当node 不是context,document的时候，取node.parentNode</span></span><br><span class="line">      node = node !== context &amp;&amp; !<span class="title function_">isDocument</span>(node) &amp;&amp; node.<span class="property">parentNode</span></span><br><span class="line">      <span class="keyword">return</span> $(node)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//取集合所有父级元素</span></span><br><span class="line">    <span class="attr">parents</span>: <span class="keyword">function</span>(<span class="params">selector</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> ancestors = [],</span><br><span class="line">        nodes = <span class="variable language_">this</span></span><br><span class="line">        <span class="comment">//通过遍历nodes得到所有父级，注意在while里nodes被重新赋值了</span></span><br><span class="line">        <span class="comment">//本函数的巧妙之处在于，不停在获取父级，再遍历父级获取父级的父级</span></span><br><span class="line">        <span class="comment">//然后再通过去重，得到最终想要的结果，当到达最顶层的父级时，nodes.length就为0了</span></span><br><span class="line">      <span class="keyword">while</span> (nodes.<span class="property">length</span> &gt; <span class="number">0</span>)</span><br><span class="line">      <span class="comment">//nodes被重新赋值为收集到的父级集合</span></span><br><span class="line">      nodes = $.<span class="title function_">map</span>(nodes, <span class="keyword">function</span>(<span class="params">node</span>) &#123;</span><br><span class="line">        <span class="comment">//遍历nodes，收集集合的第一层父级</span></span><br><span class="line">        <span class="comment">//ancestors.indexOf(node) &lt; 0用来去重复</span></span><br><span class="line">        <span class="keyword">if</span> ((node = node.<span class="property">parentNode</span>) &amp;&amp; !<span class="title function_">isDocument</span>(node) &amp;&amp; ancestors.<span class="title function_">indexOf</span>(node) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">          ancestors.<span class="title function_">push</span>(node) <span class="comment">//收集已经获取到的父级元素，用于去重复</span></span><br><span class="line">          <span class="keyword">return</span> node</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">//上面还只是取到了所有的父级元素，这里还需要对其进行筛选从而得到最终想要的结果</span></span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">filtered</span>(ancestors, selector)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//获取集合的父节点</span></span><br><span class="line">    <span class="attr">parent</span>: <span class="keyword">function</span>(<span class="params">selector</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">filtered</span>(<span class="title function_">uniq</span>(<span class="variable language_">this</span>.<span class="title function_">pluck</span>(<span class="string">&#x27;parentNode&#x27;</span>)), selector)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">children</span>: <span class="keyword">function</span>(<span class="params">selector</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">filtered</span>(<span class="variable language_">this</span>.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">children</span>(<span class="variable language_">this</span>)</span><br><span class="line">      &#125;), selector)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">contents</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> slice.<span class="title function_">call</span>(<span class="variable language_">this</span>.<span class="property">childNodes</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">siblings</span>: <span class="keyword">function</span>(<span class="params">selector</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">filtered</span>(<span class="variable language_">this</span>.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">i, el</span>) &#123;</span><br><span class="line">        <span class="comment">//先获取该节点的父节点中的所有子节点，再排除本身</span></span><br><span class="line">        <span class="keyword">return</span> filter.<span class="title function_">call</span>(<span class="title function_">children</span>(el.<span class="property">parentNode</span>), <span class="keyword">function</span>(<span class="params">child</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> child !== el</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;), selector)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">empty</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">innerHTML</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//根据属性来获取当前集合的相关集合</span></span><br><span class="line">    <span class="attr">pluck</span>: <span class="keyword">function</span>(<span class="params">property</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> $.<span class="title function_">map</span>(<span class="variable language_">this</span>, <span class="keyword">function</span>(<span class="params">el</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> el[property]</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">show</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">//清除元素的内联display=&quot;none&quot;的样式</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">style</span>.<span class="property">display</span> == <span class="string">&quot;none&quot;</span> &amp;&amp; (<span class="variable language_">this</span>.<span class="property">style</span>.<span class="property">display</span> = <span class="literal">null</span>)</span><br><span class="line">        <span class="comment">//当样式表里的该元素的display样式为none时，设置它的display为默认值</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">getComputedStyle</span>(<span class="variable language_">this</span>, <span class="string">&#x27;&#x27;</span>).<span class="title function_">getPropertyValue</span>(<span class="string">&quot;display&quot;</span>) == <span class="string">&quot;none&quot;</span>) <span class="variable language_">this</span>.<span class="property">style</span>.<span class="property">display</span> = <span class="title function_">defaultDisplay</span>(<span class="variable language_">this</span>.<span class="property">nodeName</span>) <span class="comment">//defaultDisplay是获取元素默认display的方法</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">replaceWith</span>: <span class="keyword">function</span>(<span class="params">newContent</span>) &#123;</span><br><span class="line">      <span class="comment">//将要替换的内容插入到被替换的内容前面，然后删除被替换的内容</span></span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">before</span>(newContent).<span class="title function_">remove</span>()</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">wrap</span>: <span class="keyword">function</span>(<span class="params">structure</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> func = <span class="title function_">isFunction</span>(structure)</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>[<span class="number">0</span>] &amp;&amp; !func)</span><br><span class="line">      <span class="comment">//如果structure是字符串，则将其转成DOM</span></span><br><span class="line">      <span class="keyword">var</span> dom = $(structure).<span class="title function_">get</span>(<span class="number">0</span>),</span><br><span class="line">        <span class="comment">//如果structure是已经存在于页面上的节点或者被wrap的记录不只一条，则需要clone dom</span></span><br><span class="line">        clone = dom.<span class="property">parentNode</span> || <span class="variable language_">this</span>.<span class="property">length</span> &gt; <span class="number">1</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">index</span>) &#123;</span><br><span class="line">        $(<span class="variable language_">this</span>).<span class="title function_">wrapAll</span>(</span><br><span class="line">        func ? structure.<span class="title function_">call</span>(<span class="variable language_">this</span>, index) : clone ? dom.<span class="title function_">cloneNode</span>(<span class="literal">true</span>) : dom)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">wrapAll</span>: <span class="keyword">function</span>(<span class="params">structure</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>[<span class="number">0</span>]) &#123;</span><br><span class="line">        <span class="comment">//将要包裹的内容插入到第一条记录的前面，算是给structure定位围置</span></span><br><span class="line">        $(<span class="variable language_">this</span>[<span class="number">0</span>]).<span class="title function_">before</span>(structure = $(structure))</span><br><span class="line">        <span class="keyword">var</span> children</span><br><span class="line">        <span class="comment">// drill down to the inmost element</span></span><br><span class="line">        <span class="comment">//取structure里的第一个子节点的最里层</span></span><br><span class="line">        <span class="keyword">while</span> ((children = structure.<span class="title function_">children</span>()).<span class="property">length</span>) structure = children.<span class="title function_">first</span>()</span><br><span class="line">        <span class="comment">//将当前集合插入到最里层的节点里，达到wrapAll的目的</span></span><br><span class="line">        $(structure).<span class="title function_">append</span>(<span class="variable language_">this</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//在匹配元素里的内容外包一层结构</span></span><br><span class="line">    <span class="attr">wrapInner</span>: <span class="keyword">function</span>(<span class="params">structure</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> func = <span class="title function_">isFunction</span>(structure)</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">index</span>) &#123;</span><br><span class="line">        <span class="comment">//原理就是获取节点的内容，然后用structure将内容包起来，如果内容不存在，则直接将structure append到该节点</span></span><br><span class="line">        <span class="keyword">var</span> self = $(<span class="variable language_">this</span>),</span><br><span class="line">          contents = self.<span class="title function_">contents</span>(),</span><br><span class="line">          dom = func ? structure.<span class="title function_">call</span>(<span class="variable language_">this</span>, index) : structure</span><br><span class="line">          contents.<span class="property">length</span> ? contents.<span class="title function_">wrapAll</span>(dom) : self.<span class="title function_">append</span>(dom)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">unwrap</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">//用子元素替换掉父级</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">parent</span>().<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        $(<span class="variable language_">this</span>).<span class="title function_">replaceWith</span>($(<span class="variable language_">this</span>).<span class="title function_">children</span>())</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//clone node</span></span><br><span class="line">    <span class="attr">clone</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">cloneNode</span>(<span class="literal">true</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//隐藏集合</span></span><br><span class="line">    <span class="attr">hide</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">css</span>(<span class="string">&quot;display&quot;</span>, <span class="string">&quot;none&quot;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">toggle</span>: <span class="keyword">function</span>(<span class="params">setting</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> el = $(<span class="variable language_">this</span>);</span><br><span class="line">        <span class="comment">/* </span></span><br><span class="line"><span class="comment">            这个setting取得作用就是控制显示与隐藏，并不切换，当它的值为true时，一直显示，false时，一直隐藏</span></span><br><span class="line"><span class="comment">            这个地方的判断看上去有点绕，其实也简单，意思是说，当不给toogle参数时，根据元素的display是否等于none来决定显示或者隐藏元素</span></span><br><span class="line"><span class="comment">            当给toogle参数，就没有切换效果了，只是简单的根据参数值来决定显示或隐藏。如果参数true,相当于show方法，false则相当于hide方法</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        (setting === <span class="literal">undefined</span> ? el.<span class="title function_">css</span>(<span class="string">&quot;display&quot;</span>) == <span class="string">&quot;none&quot;</span> : setting) ? el.<span class="title function_">show</span>() : el.<span class="title function_">hide</span>()</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">prev</span>: <span class="keyword">function</span>(<span class="params">selector</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> $(<span class="variable language_">this</span>.<span class="title function_">pluck</span>(<span class="string">&#x27;previousElementSibling&#x27;</span>)).<span class="title function_">filter</span>(selector || <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">next</span>: <span class="keyword">function</span>(<span class="params">selector</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> $(<span class="variable language_">this</span>.<span class="title function_">pluck</span>(<span class="string">&#x27;nextElementSibling&#x27;</span>)).<span class="title function_">filter</span>(selector || <span class="string">&#x27;*&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//当有参数时，设置集合每条记录的HTML，没有参数时，则为获取集合第一条记录的HTML，如果集合的长度为0,则返回null</span></span><br><span class="line">    <span class="attr">html</span>: <span class="keyword">function</span>(<span class="params">html</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> html === <span class="literal">undefined</span> ?</span><br><span class="line">      <span class="comment">//参数html不存在时，获取集合中第一条记录的html</span></span><br><span class="line">      (<span class="variable language_">this</span>.<span class="property">length</span> &gt; <span class="number">0</span> ? <span class="variable language_">this</span>[<span class="number">0</span>].<span class="property">innerHTML</span> : <span class="literal">null</span>) :</span><br><span class="line">      <span class="comment">//否则遍历集合，设置每条记录的html</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">idx</span>) &#123;</span><br><span class="line">        <span class="comment">//记录原始的innerHTMl</span></span><br><span class="line">        <span class="keyword">var</span> originHtml = <span class="variable language_">this</span>.<span class="property">innerHTML</span></span><br><span class="line">        <span class="comment">//如果参数html是字符串直接插入到记录中，</span></span><br><span class="line">        <span class="comment">//如果是函数，则将当前记录作为上下文，调用该函数，且传入该记录的索引和原始innerHTML作为参数</span></span><br><span class="line">        $(<span class="variable language_">this</span>).<span class="title function_">empty</span>().<span class="title function_">append</span>(<span class="title function_">funcArg</span>(<span class="variable language_">this</span>, html, idx, originHtml))</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">text</span>: <span class="keyword">function</span>(<span class="params">text</span>) &#123;</span><br><span class="line">      <span class="comment">//如果不给定text参数，则为获取功能，集合长度大于0时，取第一条数据的textContent，否则返回null,</span></span><br><span class="line">      <span class="comment">//如果给定text参数，则为集合的每一条数据设置textContent为text</span></span><br><span class="line">      <span class="keyword">return</span> text === <span class="literal">undefined</span> ? (<span class="variable language_">this</span>.<span class="property">length</span> &gt; <span class="number">0</span> ? <span class="variable language_">this</span>[<span class="number">0</span>].<span class="property">textContent</span> : <span class="literal">null</span>) : <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">textContent</span> = text</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">attr</span>: <span class="keyword">function</span>(<span class="params">name, value</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> result</span><br><span class="line">      <span class="comment">//当只有name且为字符串时，表示获取第一条记录的属性</span></span><br><span class="line">      <span class="keyword">return</span> (<span class="keyword">typeof</span> name == <span class="string">&#x27;string&#x27;</span> &amp;&amp; value === <span class="literal">undefined</span>) ?</span><br><span class="line">      <span class="comment">//集合没有记录或者集合的元素不是node类型，返回undefined</span></span><br><span class="line">      (<span class="variable language_">this</span>.<span class="property">length</span> == <span class="number">0</span> || <span class="variable language_">this</span>[<span class="number">0</span>].<span class="property">nodeType</span> !== <span class="number">1</span> ? <span class="literal">undefined</span> :</span><br><span class="line">      <span class="comment">//如果取的是input的value</span></span><br><span class="line">      (name == <span class="string">&#x27;value&#x27;</span> &amp;&amp; <span class="variable language_">this</span>[<span class="number">0</span>].<span class="property">nodeName</span> == <span class="string">&#x27;INPUT&#x27;</span>) ? <span class="variable language_">this</span>.<span class="title function_">val</span>() :</span><br><span class="line">      <span class="comment">//注意直接定义在node上的属性，在标准浏览器和ie9,10中用getAttribute取不到,得到的结果是null</span></span><br><span class="line">      <span class="comment">//比如div.aa = 10,用div.getAttribute(&#x27;aa&#x27;)得到的是null,需要用div.aa或者div[&#x27;aa&#x27;]这样来取</span></span><br><span class="line">      (!(result = <span class="variable language_">this</span>[<span class="number">0</span>].<span class="title function_">getAttribute</span>(name)) &amp;&amp; name <span class="keyword">in</span> <span class="variable language_">this</span>[<span class="number">0</span>]) ? <span class="variable language_">this</span>[<span class="number">0</span>][name] : result) :</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">idx</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">nodeType</span> !== <span class="number">1</span>) <span class="keyword">return</span></span><br><span class="line">        <span class="comment">//如果name是一个对象，如&#123;&#x27;id&#x27;:&#x27;test&#x27;,&#x27;value&#x27;:11&#125;,则给数据设置属性</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isObject</span>(name)) <span class="keyword">for</span> (key <span class="keyword">in</span> name) <span class="title function_">setAttribute</span>(<span class="variable language_">this</span>, key, name[key])</span><br><span class="line">        <span class="comment">//如果name只是一个普通的属性字符串，用funcArg来处理value是值或者function的情况最终返回一个属性值</span></span><br><span class="line">        <span class="comment">//如果funcArg函数返回的是undefined或者null，则相当于删除元素的属性</span></span><br><span class="line">        <span class="keyword">else</span> <span class="title function_">setAttribute</span>(<span class="variable language_">this</span>, name, <span class="title function_">funcArg</span>(<span class="variable language_">this</span>, value, idx, <span class="variable language_">this</span>.<span class="title function_">getAttribute</span>(name)))</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">removeAttr</span>: <span class="keyword">function</span>(<span class="params">name</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">nodeType</span> === <span class="number">1</span> &amp;&amp; <span class="title function_">setAttribute</span>(<span class="variable language_">this</span>, name)<span class="comment">//setAttribute的第三个参数为null时，效果是删除name属性</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//获取第一条数据的指定的name属性或者给每条数据添加自定义属性，注意和setAttribute的区别</span></span><br><span class="line">    <span class="attr">prop</span>: <span class="keyword">function</span>(<span class="params">name, value</span>) &#123;</span><br><span class="line">      <span class="comment">//没有给定value时，为获取，给定value则给每一条数据添加，value可以为值也可以是一个返回值的函数</span></span><br><span class="line">      <span class="keyword">return</span> (value === <span class="literal">undefined</span>) ? (<span class="variable language_">this</span>[<span class="number">0</span>] &amp;&amp; <span class="variable language_">this</span>[<span class="number">0</span>][name]) : <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">idx</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>[name] = <span class="title function_">funcArg</span>(<span class="variable language_">this</span>, value, idx, <span class="variable language_">this</span>[name])</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">data</span>: <span class="keyword">function</span>(<span class="params">name, value</span>) &#123;</span><br><span class="line">      <span class="comment">//通过调用attr方法来实现获取与设置的效果，注意attr方法里，当value存在的时候，返回的是集合本身，如果不存在，则是返回获取的值</span></span><br><span class="line">      <span class="keyword">var</span> data = <span class="variable language_">this</span>.<span class="title function_">attr</span>(<span class="string">&#x27;data-&#x27;</span> + <span class="title function_">dasherize</span>(name), value)</span><br><span class="line">      <span class="keyword">return</span> data !== <span class="literal">null</span> ? <span class="title function_">deserializeValue</span>(data) : <span class="literal">undefined</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">val</span>: <span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> (value === <span class="literal">undefined</span>) ?</span><br><span class="line">      <span class="comment">//如果是多选的select，则返回一个包含被选中的option的值的数组</span></span><br><span class="line">      (<span class="variable language_">this</span>[<span class="number">0</span>] &amp;&amp; (<span class="variable language_">this</span>[<span class="number">0</span>].<span class="property">multiple</span> ? $(<span class="variable language_">this</span>[<span class="number">0</span>]).<span class="title function_">find</span>(<span class="string">&#x27;option&#x27;</span>).<span class="title function_">filter</span>(<span class="keyword">function</span>(<span class="params">o</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">selected</span></span><br><span class="line">      &#125;).<span class="title function_">pluck</span>(<span class="string">&#x27;value&#x27;</span>) : <span class="variable language_">this</span>[<span class="number">0</span>].<span class="property">value</span>)) : <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">idx</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = <span class="title function_">funcArg</span>(<span class="variable language_">this</span>, value, idx, <span class="variable language_">this</span>.<span class="property">value</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">offset</span>: <span class="keyword">function</span>(<span class="params">coordinates</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (coordinates) <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">index</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> $this = $(<span class="variable language_">this</span>),</span><br><span class="line">          <span class="comment">//coordinates为&#123;&#125;时直接返回，为函数时返回处理结果给coords</span></span><br><span class="line">          coords = <span class="title function_">funcArg</span>(<span class="variable language_">this</span>, coordinates, index, $this.<span class="title function_">offset</span>()),</span><br><span class="line">          <span class="comment">//取父级的offset</span></span><br><span class="line">          parentOffset = $this.<span class="title function_">offsetParent</span>().<span class="title function_">offset</span>(),</span><br><span class="line">          <span class="comment">//计算出它们之间的差，得出其偏移量  </span></span><br><span class="line">          props = &#123;</span><br><span class="line">            <span class="attr">top</span>: coords.<span class="property">top</span> - parentOffset.<span class="property">top</span>,</span><br><span class="line">            <span class="attr">left</span>: coords.<span class="property">left</span> - parentOffset.<span class="property">left</span></span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">//注意元素的position为static时，设置top,left是无效的</span></span><br><span class="line">        <span class="keyword">if</span> ($this.<span class="title function_">css</span>(<span class="string">&#x27;position&#x27;</span>) == <span class="string">&#x27;static&#x27;</span>) props[<span class="string">&#x27;position&#x27;</span>] = <span class="string">&#x27;relative&#x27;</span></span><br><span class="line">        $this.<span class="title function_">css</span>(props)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">//取第一条记录的offset,包括offsetTop,offsetLeft,offsetWidth,offsetHeight</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">length</span> == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">      <span class="keyword">var</span> obj = <span class="variable language_">this</span>[<span class="number">0</span>].<span class="title function_">getBoundingClientRect</span>()</span><br><span class="line">      <span class="comment">//window.pageYOffset就是类似Math.max(document.documentElement.scrollTop||document.body.scrollTop)</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">left</span>: obj.<span class="property">left</span> + <span class="variable language_">window</span>.<span class="property">pageXOffset</span>,</span><br><span class="line">        <span class="attr">top</span>: obj.<span class="property">top</span> + <span class="variable language_">window</span>.<span class="property">pageYOffset</span>,</span><br><span class="line">        <span class="attr">width</span>: <span class="title class_">Math</span>.<span class="title function_">round</span>(obj.<span class="property">width</span>),</span><br><span class="line">        <span class="attr">height</span>: <span class="title class_">Math</span>.<span class="title function_">round</span>(obj.<span class="property">height</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">css</span>: <span class="keyword">function</span>(<span class="params">property, value</span>) &#123;</span><br><span class="line">      <span class="comment">//获取指定的样式</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">arguments</span>.<span class="property">length</span> &lt; <span class="number">2</span> &amp;&amp; <span class="keyword">typeof</span> property == <span class="string">&#x27;string&#x27;</span>) <span class="keyword">return</span> <span class="variable language_">this</span>[<span class="number">0</span>] &amp;&amp; (<span class="variable language_">this</span>[<span class="number">0</span>].<span class="property">style</span>[<span class="title function_">camelize</span>(property)] || <span class="title function_">getComputedStyle</span>(<span class="variable language_">this</span>[<span class="number">0</span>], <span class="string">&#x27;&#x27;</span>).<span class="title function_">getPropertyValue</span>(property))</span><br><span class="line">      <span class="comment">//设置样式</span></span><br><span class="line">      <span class="keyword">var</span> css = <span class="string">&#x27;&#x27;</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">type</span>(property) == <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!value &amp;&amp; value !== <span class="number">0</span>) <span class="comment">//当value的值为非零的可以转成false的值时如(null,undefined)，删掉property样式</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="comment">//style.removeProperty 移除指定的CSS样式名(IE不支持DOM的style方法)</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">style</span>.<span class="title function_">removeProperty</span>(<span class="title function_">dasherize</span>(property))</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">else</span> css = <span class="title function_">dasherize</span>(property) + <span class="string">&quot;:&quot;</span> + <span class="title function_">maybeAddPx</span>(property, value)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//当property是对象时</span></span><br><span class="line">        <span class="keyword">for</span> (key <span class="keyword">in</span> property)</span><br><span class="line">        <span class="keyword">if</span> (!property[key] &amp;&amp; property[key] !== <span class="number">0</span>)</span><br><span class="line">        <span class="comment">//当property[key]的值为非零的可以转成false的值时，删掉key样式</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">style</span>.<span class="title function_">removeProperty</span>(<span class="title function_">dasherize</span>(key))</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">else</span> css += <span class="title function_">dasherize</span>(key) + <span class="string">&#x27;:&#x27;</span> + <span class="title function_">maybeAddPx</span>(key, property[key]) + <span class="string">&#x27;;&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//设置</span></span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">style</span>.<span class="property">cssText</span> += <span class="string">&#x27;;&#x27;</span> + css</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">index</span>: <span class="keyword">function</span>(<span class="params">element</span>) &#123;</span><br><span class="line">      <span class="comment">//这里的$(element)[0]是为了将字符串转成node,因为this是个包含node的数组</span></span><br><span class="line">      <span class="comment">//当不指定element时，取集合中第一条记录在其父节点的位置</span></span><br><span class="line">      <span class="comment">//this.parent().children().indexOf(this[0])这句很巧妙，和取第一记录的parent().children().indexOf(this)相同</span></span><br><span class="line">      <span class="keyword">return</span> element ? <span class="variable language_">this</span>.<span class="title function_">indexOf</span>($(element)[<span class="number">0</span>]) : <span class="variable language_">this</span>.<span class="title function_">parent</span>().<span class="title function_">children</span>().<span class="title function_">indexOf</span>(<span class="variable language_">this</span>[<span class="number">0</span>])</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">hasClass</span>: <span class="keyword">function</span>(<span class="params">name</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> emptyArray.<span class="property">some</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, <span class="keyword">function</span>(<span class="params">el</span>) &#123;</span><br><span class="line">        <span class="comment">//注意这里的this是classRE(name)生成的正则</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">test</span>(<span class="title function_">className</span>(el))</span><br><span class="line">      &#125;, <span class="title function_">classRE</span>(name))</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">addClass</span>: <span class="keyword">function</span>(<span class="params">name</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">idx</span>) &#123;</span><br><span class="line">        classList = []</span><br><span class="line">        <span class="keyword">var</span> cls = <span class="title function_">className</span>(<span class="variable language_">this</span>),</span><br><span class="line">          newName = <span class="title function_">funcArg</span>(<span class="variable language_">this</span>, name, idx, cls)</span><br><span class="line">          <span class="comment">//处理同时多个类的情况，用空格分开</span></span><br><span class="line">          newName.<span class="title function_">split</span>(<span class="regexp">/\s+/g</span>).<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">klass</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!$(<span class="variable language_">this</span>).<span class="title function_">hasClass</span>(klass)) classList.<span class="title function_">push</span>(klass)</span><br><span class="line">          &#125;, <span class="variable language_">this</span>)</span><br><span class="line">          classList.<span class="property">length</span> &amp;&amp; <span class="title function_">className</span>(<span class="variable language_">this</span>, cls + (cls ? <span class="string">&quot; &quot;</span> : <span class="string">&quot;&quot;</span>) + classList.<span class="title function_">join</span>(<span class="string">&quot; &quot;</span>))</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">removeClass</span>: <span class="keyword">function</span>(<span class="params">name</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">idx</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (name === <span class="literal">undefined</span>) <span class="keyword">return</span> <span class="title function_">className</span>(<span class="variable language_">this</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        classList = <span class="title function_">className</span>(<span class="variable language_">this</span>)</span><br><span class="line">        <span class="title function_">funcArg</span>(<span class="variable language_">this</span>, name, idx, classList).<span class="title function_">split</span>(<span class="regexp">/\s+/g</span>).<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">klass</span>) &#123;</span><br><span class="line">          classList = classList.<span class="title function_">replace</span>(<span class="title function_">classRE</span>(klass), <span class="string">&quot; &quot;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="title function_">className</span>(<span class="variable language_">this</span>, classList.<span class="title function_">trim</span>())</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">toggleClass</span>: <span class="keyword">function</span>(<span class="params">name, when</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">idx</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> $this = $(<span class="variable language_">this</span>),</span><br><span class="line">          names = <span class="title function_">funcArg</span>(<span class="variable language_">this</span>, name, idx, <span class="title function_">className</span>(<span class="variable language_">this</span>))</span><br><span class="line">          names.<span class="title function_">split</span>(<span class="regexp">/\s+/g</span>).<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">klass</span>) &#123;</span><br><span class="line">            (when === <span class="literal">undefined</span> ? !$this.<span class="title function_">hasClass</span>(klass) : when) ? $this.<span class="title function_">addClass</span>(klass) : $this.<span class="title function_">removeClass</span>(klass)</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">scrollTop</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">length</span>) <span class="keyword">return</span></span><br><span class="line">      <span class="keyword">return</span> (<span class="string">&#x27;scrollTop&#x27;</span> <span class="keyword">in</span> <span class="variable language_">this</span>[<span class="number">0</span>]) ? <span class="variable language_">this</span>[<span class="number">0</span>].<span class="property">scrollTop</span> : <span class="variable language_">this</span>[<span class="number">0</span>].<span class="property">scrollY</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">position</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">length</span>) <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> elem = <span class="variable language_">this</span>[<span class="number">0</span>],</span><br><span class="line">        <span class="comment">// Get *real* offsetParent</span></span><br><span class="line">        offsetParent = <span class="variable language_">this</span>.<span class="title function_">offsetParent</span>(),</span><br><span class="line">        <span class="comment">// Get correct offsets</span></span><br><span class="line">        offset = <span class="variable language_">this</span>.<span class="title function_">offset</span>(),</span><br><span class="line">        parentOffset = rootNodeRE.<span class="title function_">test</span>(offsetParent[<span class="number">0</span>].<span class="property">nodeName</span>) ? &#123;</span><br><span class="line">          <span class="attr">top</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="attr">left</span>: <span class="number">0</span></span><br><span class="line">        &#125; : offsetParent.<span class="title function_">offset</span>()</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Subtract element margins</span></span><br><span class="line">        <span class="comment">// note: when an element has margin: auto the offsetLeft and marginLeft</span></span><br><span class="line">        <span class="comment">// are the same in Safari causing offset.left to incorrectly be 0</span></span><br><span class="line">        offset.<span class="property">top</span> -= <span class="built_in">parseFloat</span>($(elem).<span class="title function_">css</span>(<span class="string">&#x27;margin-top&#x27;</span>)) || <span class="number">0</span></span><br><span class="line">        offset.<span class="property">left</span> -= <span class="built_in">parseFloat</span>($(elem).<span class="title function_">css</span>(<span class="string">&#x27;margin-left&#x27;</span>)) || <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Add offsetParent borders</span></span><br><span class="line">        parentOffset.<span class="property">top</span> += <span class="built_in">parseFloat</span>($(offsetParent[<span class="number">0</span>]).<span class="title function_">css</span>(<span class="string">&#x27;border-top-width&#x27;</span>)) || <span class="number">0</span></span><br><span class="line">        parentOffset.<span class="property">left</span> += <span class="built_in">parseFloat</span>($(offsetParent[<span class="number">0</span>]).<span class="title function_">css</span>(<span class="string">&#x27;border-left-width&#x27;</span>)) || <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Subtract the two offsets</span></span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">top</span>: offset.<span class="property">top</span> - parentOffset.<span class="property">top</span>,</span><br><span class="line">        <span class="attr">left</span>: offset.<span class="property">left</span> - parentOffset.<span class="property">left</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">offsetParent</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> parent = <span class="variable language_">this</span>.<span class="property">offsetParent</span> || <span class="variable language_">document</span>.<span class="property">body</span></span><br><span class="line">        <span class="keyword">while</span> (parent &amp;&amp; !rootNodeRE.<span class="title function_">test</span>(parent.<span class="property">nodeName</span>) &amp;&amp; $(parent).<span class="title function_">css</span>(<span class="string">&quot;position&quot;</span>) == <span class="string">&quot;static&quot;</span>)</span><br><span class="line">        parent = parent.<span class="property">offsetParent</span></span><br><span class="line">        <span class="keyword">return</span> parent</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// for now</span></span><br><span class="line">  $.fn.<span class="property">detach</span> = $.fn.<span class="property">remove</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Generate the `width` and `height` functions</span></span><br><span class="line">  ;</span><br><span class="line">  [<span class="string">&#x27;width&#x27;</span>, <span class="string">&#x27;height&#x27;</span>].<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">dimension</span>) &#123;</span><br><span class="line">    $.fn[dimension] = <span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> offset, el = <span class="variable language_">this</span>[<span class="number">0</span>],</span><br><span class="line">        <span class="comment">//将width,hegiht转成Width,Height，用于取window或者document的width和height</span></span><br><span class="line">        <span class="title class_">Dimension</span> = dimension.<span class="title function_">replace</span>(<span class="regexp">/./</span>, <span class="keyword">function</span>(<span class="params">m</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> m[<span class="number">0</span>].<span class="title function_">toUpperCase</span>()</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">//没有参数为获取，获取window的width和height用innerWidth,innerHeight</span></span><br><span class="line">      <span class="keyword">if</span> (value === <span class="literal">undefined</span>) <span class="keyword">return</span> <span class="title function_">isWindow</span>(el) ? el[<span class="string">&#x27;inner&#x27;</span> + <span class="title class_">Dimension</span>] :</span><br><span class="line">      <span class="comment">//获取document的width和height时，用offsetWidth,offsetHeight</span></span><br><span class="line">      <span class="title function_">isDocument</span>(el) ? el.<span class="property">documentElement</span>[<span class="string">&#x27;offset&#x27;</span> + <span class="title class_">Dimension</span>] : (offset = <span class="variable language_">this</span>.<span class="title function_">offset</span>()) &amp;&amp; offset[dimension]</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">idx</span>) &#123;</span><br><span class="line">        el = $(<span class="variable language_">this</span>)</span><br><span class="line">        el.<span class="title function_">css</span>(dimension, <span class="title function_">funcArg</span>(<span class="variable language_">this</span>, value, idx, el[dimension]()))</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">traverseNode</span>(<span class="params">node, fun</span>) &#123;</span><br><span class="line">    <span class="title function_">fun</span>(node)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> node.<span class="property">childNodes</span>) <span class="title function_">traverseNode</span>(node.<span class="property">childNodes</span>[key], fun)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Generate the `after`, `prepend`, `before`, `append`,</span></span><br><span class="line">  <span class="comment">// `insertAfter`, `insertBefore`, `appendTo`, and `prependTo` methods.</span></span><br><span class="line">  adjacencyOperators.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">operator, operatorIndex</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> inside = operatorIndex % <span class="number">2</span> <span class="comment">//=&gt; prepend, append</span></span><br><span class="line"></span><br><span class="line">    $.fn[operator] = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// arguments can be nodes, arrays of nodes, Zepto objects and HTML strings</span></span><br><span class="line">      <span class="keyword">var</span> argType, nodes = $.<span class="title function_">map</span>(<span class="variable language_">arguments</span>, <span class="keyword">function</span>(<span class="params">arg</span>) &#123;</span><br><span class="line">        argType = <span class="title function_">type</span>(arg)</span><br><span class="line">        <span class="keyword">return</span> argType == <span class="string">&quot;object&quot;</span> || argType == <span class="string">&quot;array&quot;</span> || arg == <span class="literal">null</span> ? arg : zepto.<span class="title function_">fragment</span>(arg)</span><br><span class="line">      &#125;),</span><br><span class="line">        parent, copyByClone = <span class="variable language_">this</span>.<span class="property">length</span> &gt; <span class="number">1</span> <span class="comment">//如果集合的长度大于集，则需要clone被插入的节点</span></span><br><span class="line">      <span class="keyword">if</span> (nodes.<span class="property">length</span> &lt; <span class="number">1</span>) <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">_, target</span>) &#123;</span><br><span class="line">        parent = inside ? target : target.<span class="property">parentNode</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//通过改变target将after，prepend，append操作转成before操作，insertBefore的第二个参数为null时等于appendChild操作</span></span><br><span class="line">        target = operatorIndex == <span class="number">0</span> ? target.<span class="property">nextSibling</span> : operatorIndex == <span class="number">1</span> ? target.<span class="property">firstChild</span> : operatorIndex == <span class="number">2</span> ? target : <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">        nodes.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">node</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (copyByClone) node = node.<span class="title function_">cloneNode</span>(<span class="literal">true</span>)</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> (!parent) <span class="keyword">return</span> $(node).<span class="title function_">remove</span>()</span><br><span class="line"></span><br><span class="line">          <span class="comment">//插入节点后，如果被插入的节点是SCRIPT，则执行里面的内容并将window设为上下文</span></span><br><span class="line">          <span class="title function_">traverseNode</span>(parent.<span class="title function_">insertBefore</span>(node, target), <span class="keyword">function</span>(<span class="params">el</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (el.<span class="property">nodeName</span> != <span class="literal">null</span> &amp;&amp; el.<span class="property">nodeName</span>.<span class="title function_">toUpperCase</span>() === <span class="string">&#x27;SCRIPT&#x27;</span> &amp;&amp; (!el.<span class="property">type</span> || el.<span class="property">type</span> === <span class="string">&#x27;text/javascript&#x27;</span>) &amp;&amp; !el.<span class="property">src</span>) <span class="variable language_">window</span>[<span class="string">&#x27;eval&#x27;</span>].<span class="title function_">call</span>(<span class="variable language_">window</span>, el.<span class="property">innerHTML</span>)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// after    =&gt; insertAfter</span></span><br><span class="line">    <span class="comment">// prepend  =&gt; prependTo</span></span><br><span class="line">    <span class="comment">// before   =&gt; insertBefore</span></span><br><span class="line">    <span class="comment">// append   =&gt; appendTo</span></span><br><span class="line">    $.fn[inside ? operator + <span class="string">&#x27;To&#x27;</span> : <span class="string">&#x27;insert&#x27;</span> + (operatorIndex ? <span class="string">&#x27;Before&#x27;</span> : <span class="string">&#x27;After&#x27;</span>)] = <span class="keyword">function</span>(<span class="params">html</span>) &#123;</span><br><span class="line">      $(html)[operator](<span class="variable language_">this</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  zepto.<span class="property">Z</span>.<span class="property"><span class="keyword">prototype</span></span> = $.fn</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Export internal API functions in the `$.zepto` namespace</span></span><br><span class="line">  zepto.<span class="property">uniq</span> = uniq</span><br><span class="line">  zepto.<span class="property">deserializeValue</span> = deserializeValue</span><br><span class="line">  $.zepto = zepto</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> $</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">Zepto</span> = <span class="title class_">Zepto</span>;</span><br><span class="line"><span class="string">&#x27;$&#x27;</span> <span class="keyword">in</span> <span class="variable language_">window</span> || (<span class="variable language_">window</span>.<span class="property">$</span> = <span class="title class_">Zepto</span>);</span><br><span class="line"></span><br><span class="line">;(<span class="keyword">function</span>(<span class="params">$</span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">detect</span>(<span class="params">ua</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> os = <span class="variable language_">this</span>.<span class="property">os</span> = &#123;&#125;, browser = <span class="variable language_">this</span>.<span class="property">browser</span> = &#123;&#125;,</span><br><span class="line">    webkit = ua.<span class="title function_">match</span>(<span class="regexp">/WebKit\/([\d.]+)/</span>),</span><br><span class="line">      android = ua.<span class="title function_">match</span>(<span class="regexp">/(Android)\s+([\d.]+)/</span>),</span><br><span class="line">      ipad = ua.<span class="title function_">match</span>(<span class="regexp">/(iPad).*OS\s([\d_]+)/</span>),</span><br><span class="line">      iphone = !ipad &amp;&amp; ua.<span class="title function_">match</span>(<span class="regexp">/(iPhone\sOS)\s([\d_]+)/</span>),</span><br><span class="line">      webos = ua.<span class="title function_">match</span>(<span class="regexp">/(webOS|hpwOS)[\s\/]([\d.]+)/</span>),</span><br><span class="line">      touchpad = webos &amp;&amp; ua.<span class="title function_">match</span>(<span class="regexp">/TouchPad/</span>),</span><br><span class="line">      kindle = ua.<span class="title function_">match</span>(<span class="regexp">/Kindle\/([\d.]+)/</span>),</span><br><span class="line">      silk = ua.<span class="title function_">match</span>(<span class="regexp">/Silk\/([\d._]+)/</span>),</span><br><span class="line">      blackberry = ua.<span class="title function_">match</span>(<span class="regexp">/(BlackBerry).*Version\/([\d.]+)/</span>),</span><br><span class="line">      bb10 = ua.<span class="title function_">match</span>(<span class="regexp">/(BB10).*Version\/([\d.]+)/</span>),</span><br><span class="line">      rimtabletos = ua.<span class="title function_">match</span>(<span class="regexp">/(RIM\sTablet\sOS)\s([\d.]+)/</span>),</span><br><span class="line">      playbook = ua.<span class="title function_">match</span>(<span class="regexp">/PlayBook/</span>),</span><br><span class="line">      chrome = ua.<span class="title function_">match</span>(<span class="regexp">/Chrome\/([\d.]+)/</span>) || ua.<span class="title function_">match</span>(<span class="regexp">/CriOS\/([\d.]+)/</span>),</span><br><span class="line">      firefox = ua.<span class="title function_">match</span>(<span class="regexp">/Firefox\/([\d.]+)/</span>)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Todo: clean this up with a better OS/browser seperation:</span></span><br><span class="line">      <span class="comment">// - discern (more) between multiple browsers on android</span></span><br><span class="line">      <span class="comment">// - decide if kindle fire in silk mode is android or not</span></span><br><span class="line">      <span class="comment">// - Firefox on Android doesn&#x27;t specify the Android version</span></span><br><span class="line">      <span class="comment">// - possibly devide in os, device and browser hashes</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (browser.<span class="property">webkit</span> = !! webkit) browser.<span class="property">version</span> = webkit[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (android) os.<span class="property">android</span> = <span class="literal">true</span>, os.<span class="property">version</span> = android[<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">if</span> (iphone) os.<span class="property">ios</span> = os.<span class="property">iphone</span> = <span class="literal">true</span>, os.<span class="property">version</span> = iphone[<span class="number">2</span>].<span class="title function_">replace</span>(<span class="regexp">/_/g</span>, <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (ipad) os.<span class="property">ios</span> = os.<span class="property">ipad</span> = <span class="literal">true</span>, os.<span class="property">version</span> = ipad[<span class="number">2</span>].<span class="title function_">replace</span>(<span class="regexp">/_/g</span>, <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (webos) os.<span class="property">webos</span> = <span class="literal">true</span>, os.<span class="property">version</span> = webos[<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">if</span> (touchpad) os.<span class="property">touchpad</span> = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">if</span> (blackberry) os.<span class="property">blackberry</span> = <span class="literal">true</span>, os.<span class="property">version</span> = blackberry[<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">if</span> (bb10) os.<span class="property">bb10</span> = <span class="literal">true</span>, os.<span class="property">version</span> = bb10[<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">if</span> (rimtabletos) os.<span class="property">rimtabletos</span> = <span class="literal">true</span>, os.<span class="property">version</span> = rimtabletos[<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">if</span> (playbook) browser.<span class="property">playbook</span> = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">if</span> (kindle) os.<span class="property">kindle</span> = <span class="literal">true</span>, os.<span class="property">version</span> = kindle[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> (silk) browser.<span class="property">silk</span> = <span class="literal">true</span>, browser.<span class="property">version</span> = silk[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> (!silk &amp;&amp; os.<span class="property">android</span> &amp;&amp; ua.<span class="title function_">match</span>(<span class="regexp">/Kindle Fire/</span>)) browser.<span class="property">silk</span> = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">if</span> (chrome) browser.<span class="property">chrome</span> = <span class="literal">true</span>, browser.<span class="property">version</span> = chrome[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> (firefox) browser.<span class="property">firefox</span> = <span class="literal">true</span>, browser.<span class="property">version</span> = firefox[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    os.<span class="property">tablet</span> = !! (ipad || playbook || (android &amp;&amp; !ua.<span class="title function_">match</span>(<span class="regexp">/Mobile/</span>)) || (firefox &amp;&amp; ua.<span class="title function_">match</span>(<span class="regexp">/Tablet/</span>)))</span><br><span class="line">    os.<span class="property">phone</span> = !! (!os.<span class="property">tablet</span> &amp;&amp; (android || iphone || webos || blackberry || bb10 || (chrome &amp;&amp; ua.<span class="title function_">match</span>(<span class="regexp">/Android/</span>)) || (chrome &amp;&amp; ua.<span class="title function_">match</span>(<span class="regexp">/CriOS\/([\d.]+)/</span>)) || (firefox &amp;&amp; ua.<span class="title function_">match</span>(<span class="regexp">/Mobile/</span>))))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  detect.<span class="title function_">call</span>($, navigator.<span class="property">userAgent</span>)</span><br><span class="line">  <span class="comment">// make available to unit tests</span></span><br><span class="line">  $.__detect = detect</span><br><span class="line"></span><br><span class="line">&#125;)(<span class="title class_">Zepto</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">事件处理部份</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">;</span><br><span class="line">(<span class="keyword">function</span>(<span class="params">$</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> $$ = $.zepto.<span class="property">qsa</span>,</span><br><span class="line">    handlers = &#123;&#125;, _zid = <span class="number">1</span>,</span><br><span class="line">    specialEvents = &#123;&#125;,</span><br><span class="line">    hover = &#123;</span><br><span class="line">      <span class="attr">mouseenter</span>: <span class="string">&#x27;mouseover&#x27;</span>,</span><br><span class="line">      <span class="attr">mouseleave</span>: <span class="string">&#x27;mouseout&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  specialEvents.<span class="property">click</span> = specialEvents.<span class="property">mousedown</span> = specialEvents.<span class="property">mouseup</span> = specialEvents.<span class="property">mousemove</span> = <span class="string">&#x27;MouseEvents&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//取element的唯一标示符，如果没有，则设置一个并返回</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">zid</span>(<span class="params">element</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> element.<span class="property">_zid</span> || (element.<span class="property">_zid</span> = _zid++)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//查找绑定在元素上的指定类型的事件处理函数集合</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">findHandlers</span>(<span class="params">element, event, fn, selector</span>) &#123;</span><br><span class="line">    event = <span class="title function_">parse</span>(event)</span><br><span class="line">    <span class="keyword">if</span> (event.<span class="property">ns</span>) <span class="keyword">var</span> matcher = <span class="title function_">matcherFor</span>(event.<span class="property">ns</span>)</span><br><span class="line">    <span class="keyword">return</span> (handlers[<span class="title function_">zid</span>(element)] || []).<span class="title function_">filter</span>(<span class="keyword">function</span>(<span class="params">handler</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> handler &amp;&amp; (!event.<span class="property">e</span> || handler.<span class="property">e</span> == event.<span class="property">e</span>) <span class="comment">//判断事件类型是否相同</span></span><br><span class="line">      &amp;&amp;</span><br><span class="line">      (!event.<span class="property">ns</span> || matcher.<span class="title function_">test</span>(handler.<span class="property">ns</span>)) <span class="comment">//判断事件命名空间是否相同</span></span><br><span class="line">      <span class="comment">//注意函数是引用类型的数据zid(handler.fn)的作用是返回handler.fn的标示符，如果没有，则给它添加一个，</span></span><br><span class="line">      <span class="comment">//这样如果fn和handler.fn引用的是同一个函数，那么fn上应该也可相同的标示符，</span></span><br><span class="line">      <span class="comment">//这里就是通过这一点来判断两个变量是否引用的同一个函数</span></span><br><span class="line">      &amp;&amp;</span><br><span class="line">      (!fn || <span class="title function_">zid</span>(handler.<span class="property">fn</span>) === <span class="title function_">zid</span>(fn)) &amp;&amp; (!selector || handler.<span class="property">sel</span> == selector)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//解析事件类型，返回一个包含事件名称和事件命名空间的对象</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">parse</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> parts = (<span class="string">&#x27;&#x27;</span> + event).<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">e</span>: parts[<span class="number">0</span>],</span><br><span class="line">      <span class="attr">ns</span>: parts.<span class="title function_">slice</span>(<span class="number">1</span>).<span class="title function_">sort</span>().<span class="title function_">join</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//生成命名空间的正则</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">matcherFor</span>(<span class="params">ns</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">&#x27;(?:^| )&#x27;</span> + ns.<span class="title function_">replace</span>(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27; .* ?&#x27;</span>) + <span class="string">&#x27;(?: |$)&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//遍历events</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">eachEvent</span>(<span class="params">events, fn, iterator</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> ($.<span class="title function_">type</span>(events) != <span class="string">&quot;string&quot;</span>) $.<span class="title function_">each</span>(events, iterator)</span><br><span class="line">    <span class="keyword">else</span> events.<span class="title function_">split</span>(<span class="regexp">/\s/</span>).<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">type</span>) &#123;</span><br><span class="line">      <span class="title function_">iterator</span>(type, fn)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//通过给focus和blur事件设置为捕获来达到事件冒泡的目的</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">eventCapture</span>(<span class="params">handler, captureSetting</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> handler.<span class="property">del</span> &amp;&amp; (handler.<span class="property">e</span> == <span class="string">&#x27;focus&#x27;</span> || handler.<span class="property">e</span> == <span class="string">&#x27;blur&#x27;</span>) || !! captureSetting</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//修复不支持mouseenter和mouseleave的情况</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">realEvent</span>(<span class="params">type</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> hover[type] || type</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//给元素绑定监听事件,可同时绑定多个事件类型，如[&#x27;click&#x27;,&#x27;mouseover&#x27;,&#x27;mouseout&#x27;],也可以是&#x27;click mouseover mouseout&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">element, events, fn, selector, getDelegate, capture</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> id = <span class="title function_">zid</span>(element),</span><br><span class="line">      set = (handlers[id] || (handlers[id] = [])) <span class="comment">//元素上已经绑定的所有事件处理函数</span></span><br><span class="line">      <span class="title function_">eachEvent</span>(events, fn, <span class="keyword">function</span>(<span class="params">event, fn</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> handler = <span class="title function_">parse</span>(event)</span><br><span class="line">        <span class="comment">//保存fn,下面为了处理mouseenter, mouseleave时，对fn进行了修改</span></span><br><span class="line">        handler.<span class="property">fn</span> = fn</span><br><span class="line">        handler.<span class="property">sel</span> = selector</span><br><span class="line">        <span class="comment">// 模仿 mouseenter, mouseleave</span></span><br><span class="line">        <span class="keyword">if</span> (handler.<span class="property">e</span> <span class="keyword">in</span> hover) fn = <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">          <span class="comment">/* </span></span><br><span class="line"><span class="comment">            relatedTarget为事件相关对象，只有在mouseover和mouseout事件时才有值</span></span><br><span class="line"><span class="comment">            mouseover时表示的是鼠标移出的那个对象，mouseout时表示的是鼠标移入的那个对象</span></span><br><span class="line"><span class="comment">            当related不存在，表示事件不是mouseover或者mouseout,mouseover时!$.contains(this, related)当相关对象不在事件对象内</span></span><br><span class="line"><span class="comment">            且related !== this相关对象不是事件对象时，表示鼠标已经从事件对象外部移入到了对象本身，这个时间是要执行处理函数的</span></span><br><span class="line"><span class="comment">            当鼠标从事件对象上移入到子节点的时候related就等于this了，且!$.contains(this, related)也不成立，这个时间是不需要执行处理函数的</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">          <span class="keyword">var</span> related = e.<span class="property">relatedTarget</span></span><br><span class="line">          <span class="keyword">if</span> (!related || (related !== <span class="variable language_">this</span> &amp;&amp; !$.<span class="title function_">contains</span>(<span class="variable language_">this</span>, related))) <span class="keyword">return</span> handler.<span class="property">fn</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//事件委托</span></span><br><span class="line">        handler.<span class="property">del</span> = getDelegate &amp;&amp; <span class="title function_">getDelegate</span>(fn, event)</span><br><span class="line">        <span class="keyword">var</span> callback = handler.<span class="property">del</span> || fn</span><br><span class="line">        handler.<span class="property">proxy</span> = <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">          <span class="keyword">var</span> result = callback.<span class="title function_">apply</span>(element, [e].<span class="title function_">concat</span>(e.<span class="property">data</span>))</span><br><span class="line">          <span class="comment">//当事件处理函数返回false时，阻止默认操作和冒泡</span></span><br><span class="line">          <span class="keyword">if</span> (result === <span class="literal">false</span>) e.<span class="title function_">preventDefault</span>(), e.<span class="title function_">stopPropagation</span>()</span><br><span class="line">          <span class="keyword">return</span> result</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//设置处理函数的在函数集中的位置</span></span><br><span class="line">        handler.<span class="property">i</span> = set.<span class="property">length</span></span><br><span class="line">        <span class="comment">//将函数存入函数集中</span></span><br><span class="line">        set.<span class="title function_">push</span>(handler)</span><br><span class="line">        element.<span class="title function_">addEventListener</span>(<span class="title function_">realEvent</span>(handler.<span class="property">e</span>), handler.<span class="property">proxy</span>, <span class="title function_">eventCapture</span>(handler, capture))</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//删除绑定在元素上的指定类型的事件监听函数，可同时删除多种事件类型指定的函数，用数组或者还空格的字符串即可，同add</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">remove</span>(<span class="params">element, events, fn, selector, capture</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> id = <span class="title function_">zid</span>(element)</span><br><span class="line">    <span class="title function_">eachEvent</span>(events || <span class="string">&#x27;&#x27;</span>, fn, <span class="keyword">function</span>(<span class="params">event, fn</span>) &#123;</span><br><span class="line">      <span class="title function_">findHandlers</span>(element, event, fn, selector).<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">handler</span>) &#123;</span><br><span class="line">        <span class="keyword">delete</span> handlers[id][handler.<span class="property">i</span>]</span><br><span class="line">        element.<span class="title function_">removeEventListener</span>(<span class="title function_">realEvent</span>(handler.<span class="property">e</span>), handler.<span class="property">proxy</span>, <span class="title function_">eventCapture</span>(handler, capture))</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.event = &#123;</span><br><span class="line">    <span class="attr">add</span>: add,</span><br><span class="line">    <span class="attr">remove</span>: remove</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//设置代理</span></span><br><span class="line">  $.proxy = <span class="keyword">function</span>(<span class="params">fn, context</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> ($.<span class="title function_">isFunction</span>(fn)) &#123;</span><br><span class="line">      <span class="comment">//如果fn是函数，则申明一个新的函数并用context作为上下文调用fn</span></span><br><span class="line">      <span class="keyword">var</span> proxyFn = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> fn.<span class="title function_">apply</span>(context, <span class="variable language_">arguments</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//引用fn标示符</span></span><br><span class="line">      proxyFn.<span class="property">_zid</span> = <span class="title function_">zid</span>(fn)</span><br><span class="line">      <span class="keyword">return</span> proxyFn</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> context == <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> $.<span class="title function_">proxy</span>(fn[context], fn)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;expected function&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.fn.<span class="property">bind</span> = <span class="keyword">function</span>(<span class="params">event, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">add</span>(<span class="variable language_">this</span>, event, callback)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  $.fn.<span class="property">unbind</span> = <span class="keyword">function</span>(<span class="params">event, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">remove</span>(<span class="variable language_">this</span>, event, callback)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//绑定一次性事件监听函数</span></span><br><span class="line">  $.fn.<span class="property">one</span> = <span class="keyword">function</span>(<span class="params">event, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">i, element</span>) &#123;</span><br><span class="line">      <span class="comment">//添加函数，然后在回调函数里再删除绑定。达到一次性事件的目的</span></span><br><span class="line">      <span class="title function_">add</span>(<span class="variable language_">this</span>, event, callback, <span class="literal">null</span>, <span class="keyword">function</span>(<span class="params">fn, type</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="keyword">var</span> result = fn.<span class="title function_">apply</span>(element, <span class="variable language_">arguments</span>) <span class="comment">//这里执行绑定的回调</span></span><br><span class="line">          <span class="title function_">remove</span>(element, type, fn) <span class="comment">//删除上面的绑定</span></span><br><span class="line">          <span class="keyword">return</span> result</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> returnTrue = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  returnFalse = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;,</span><br><span class="line">  ignoreProperties = <span class="regexp">/^([A-Z]|layer[XY]$)/</span>,</span><br><span class="line">    eventMethods = &#123;</span><br><span class="line">      <span class="attr">preventDefault</span>: <span class="string">&#x27;isDefaultPrevented&#x27;</span>, <span class="comment">//是否调用过preventDefault方法</span></span><br><span class="line">      <span class="comment">//取消执行其他的事件处理函数并取消事件冒泡.如果同一个事件绑定了多个事件处理函数, 在其中一个事件处理函数中调用此方法后将不会继续调用其他的事件处理函数.</span></span><br><span class="line">      <span class="attr">stopImmediatePropagation</span>: <span class="string">&#x27;isImmediatePropagationStopped&#x27;</span>, <span class="comment">//是否调用过stopImmediatePropagation方法，</span></span><br><span class="line">      <span class="attr">stopPropagation</span>: <span class="string">&#x27;isPropagationStopped&#x27;</span> <span class="comment">//是否调用过stopPropagation方法</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//创建事件代理</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">createProxy</span>(<span class="params">event</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> key, proxy = &#123;</span><br><span class="line">        <span class="attr">originalEvent</span>: event</span><br><span class="line">      &#125; <span class="comment">//保存原始event</span></span><br><span class="line">      <span class="keyword">for</span> (key <span class="keyword">in</span> event)</span><br><span class="line">      <span class="keyword">if</span> (!ignoreProperties.<span class="title function_">test</span>(key) &amp;&amp; event[key] !== <span class="literal">undefined</span>) proxy[key] = event[key] <span class="comment">//复制event属性至proxy</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//将preventDefault，stopImmediatePropagatio,stopPropagation方法定义到proxy上</span></span><br><span class="line">      $.<span class="title function_">each</span>(eventMethods, <span class="keyword">function</span>(<span class="params">name, predicate</span>) &#123;</span><br><span class="line">        proxy[name] = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>[predicate] = returnTrue</span><br><span class="line">          <span class="keyword">return</span> event[name].<span class="title function_">apply</span>(event, <span class="variable language_">arguments</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        proxy[predicate] = returnFalse</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> proxy</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// emulates the &#x27;defaultPrevented&#x27; property for browsers that have none</span></span><br><span class="line">    <span class="comment">//event.defaultPrevented返回一个布尔值,表明当前事件的默认动作是否被取消,也就是是否执行了 event.preventDefault()方法.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">fix</span>(<span class="params">event</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!(<span class="string">&#x27;defaultPrevented&#x27;</span> <span class="keyword">in</span> event)) &#123;</span><br><span class="line">        event.<span class="property">defaultPrevented</span> = <span class="literal">false</span> <span class="comment">//初始值false</span></span><br><span class="line">        <span class="keyword">var</span> prevent = event.<span class="property">preventDefault</span> <span class="comment">// 引用默认preventDefault</span></span><br><span class="line">        event.<span class="property">preventDefault</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="comment">//重写preventDefault</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">defaultPrevented</span> = <span class="literal">true</span></span><br><span class="line">          prevent.<span class="title function_">call</span>(<span class="variable language_">this</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//事件委托</span></span><br><span class="line">    $.fn.<span class="property">delegate</span> = <span class="keyword">function</span>(<span class="params">selector, event, callback</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">i, element</span>) &#123;</span><br><span class="line">        <span class="title function_">add</span>(element, event, callback, selector, <span class="keyword">function</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">            <span class="comment">//如果事件对象是element里的元素,取与selector相匹配的</span></span><br><span class="line">            <span class="keyword">var</span> evt, match = $(e.<span class="property">target</span>).<span class="title function_">closest</span>(selector, element).<span class="title function_">get</span>(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> (match) &#123;</span><br><span class="line">              <span class="comment">//evt成了一个拥有preventDefault，stopImmediatePropagatio,stopPropagation方法，currentTarge,liveFiredn属性的对象,另也有e的默认属性</span></span><br><span class="line">              evt = $.<span class="title function_">extend</span>(<span class="title function_">createProxy</span>(e), &#123;</span><br><span class="line">                <span class="attr">currentTarget</span>: match,</span><br><span class="line">                <span class="attr">liveFired</span>: element</span><br><span class="line">              &#125;)</span><br><span class="line">              <span class="keyword">return</span> fn.<span class="title function_">apply</span>(match, [evt].<span class="title function_">concat</span>([].<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="number">1</span>)))</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//取消事件委托</span></span><br><span class="line">    $.fn.<span class="property">undelegate</span> = <span class="keyword">function</span>(<span class="params">selector, event, callback</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">remove</span>(<span class="variable language_">this</span>, event, callback, selector)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  $.fn.<span class="property">live</span> = <span class="keyword">function</span>(<span class="params">event, callback</span>) &#123;</span><br><span class="line">    $(<span class="variable language_">document</span>.<span class="property">body</span>).<span class="title function_">delegate</span>(<span class="variable language_">this</span>.<span class="property">selector</span>, event, callback)</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line">  $.fn.<span class="property">die</span> = <span class="keyword">function</span>(<span class="params">event, callback</span>) &#123;</span><br><span class="line">    $(<span class="variable language_">document</span>.<span class="property">body</span>).<span class="title function_">undelegate</span>(<span class="variable language_">this</span>.<span class="property">selector</span>, event, callback)</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//on也有live和事件委托的效果，所以可以只用on来绑定事件</span></span><br><span class="line">  $.fn.<span class="property">on</span> = <span class="keyword">function</span>(<span class="params">event, selector, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> !selector || $.<span class="title function_">isFunction</span>(selector) ? <span class="variable language_">this</span>.<span class="title function_">bind</span>(event, selector || callback) : <span class="variable language_">this</span>.<span class="title function_">delegate</span>(selector, event, callback)</span><br><span class="line">  &#125;</span><br><span class="line">  $.fn.<span class="property">off</span> = <span class="keyword">function</span>(<span class="params">event, selector, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> !selector || $.<span class="title function_">isFunction</span>(selector) ? <span class="variable language_">this</span>.<span class="title function_">unbind</span>(event, selector || callback) : <span class="variable language_">this</span>.<span class="title function_">undelegate</span>(selector, event, callback)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//主动触发事件</span></span><br><span class="line">  $.fn.<span class="property">trigger</span> = <span class="keyword">function</span>(<span class="params">event, data</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> event == <span class="string">&#x27;string&#x27;</span> || $.<span class="title function_">isPlainObject</span>(event)) event = $.<span class="title class_">Event</span>(event)</span><br><span class="line">    <span class="title function_">fix</span>(event)</span><br><span class="line">    event.<span class="property">data</span> = data</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// items in the collection might not be DOM elements</span></span><br><span class="line">      <span class="comment">// (todo: possibly support events on plain old objects)</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="string">&#x27;dispatchEvent&#x27;</span> <span class="keyword">in</span> <span class="variable language_">this</span>) <span class="variable language_">this</span>.<span class="title function_">dispatchEvent</span>(event)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// triggers event handlers on current element just as if an event occurred,</span></span><br><span class="line">  <span class="comment">// doesn&#x27;t trigger an actual event, doesn&#x27;t bubble</span></span><br><span class="line">  <span class="comment">//触发元素上绑定的指定类型的事件，但是不冒泡</span></span><br><span class="line">  $.fn.<span class="property">triggerHandler</span> = <span class="keyword">function</span>(<span class="params">event, data</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> e, result</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">i, element</span>) &#123;</span><br><span class="line">      e = <span class="title function_">createProxy</span>(<span class="keyword">typeof</span> event == <span class="string">&#x27;string&#x27;</span> ? $.<span class="title class_">Event</span>(event) : event)</span><br><span class="line">      e.<span class="property">data</span> = data</span><br><span class="line">      e.<span class="property">target</span> = element</span><br><span class="line">      <span class="comment">//遍历元素上绑定的指定类型的事件处理函数集，按顺序执行，如果执行过stopImmediatePropagation，</span></span><br><span class="line">      <span class="comment">//那么e.isImmediatePropagationStopped()就会返回true,再外层函数返回false</span></span><br><span class="line">      <span class="comment">//注意each里的回调函数指定返回false时，会跳出循环，这样就达到的停止执行回面函数的目的</span></span><br><span class="line">      $.<span class="title function_">each</span>(<span class="title function_">findHandlers</span>(element, event.<span class="property">type</span> || event), <span class="keyword">function</span>(<span class="params">i, handler</span>) &#123;</span><br><span class="line">        result = handler.<span class="title function_">proxy</span>(e)</span><br><span class="line">        <span class="keyword">if</span> (e.<span class="title function_">isImmediatePropagationStopped</span>()) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// shortcut methods for `.bind(event, fn)` for each event type</span></span><br><span class="line">  ;</span><br><span class="line">  (<span class="string">&#x27;focusin focusout load resize scroll unload click dblclick &#x27;</span> +</span><br><span class="line">    <span class="string">&#x27;mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave &#x27;</span> +</span><br><span class="line">    <span class="string">&#x27;change select keydown keypress keyup error&#x27;</span>).<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>).<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    $.fn[event] = <span class="keyword">function</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> callback ?</span><br><span class="line">      <span class="comment">//如果有callback回调，则认为它是绑定</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">bind</span>(event, callback) :</span><br><span class="line">      <span class="comment">//如果没有callback回调，则让它主动触发</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">trigger</span>(event)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  ;</span><br><span class="line">  [<span class="string">&#x27;focus&#x27;</span>, <span class="string">&#x27;blur&#x27;</span>].<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    $.fn[name] = <span class="keyword">function</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (callback) <span class="variable language_">this</span>.<span class="title function_">bind</span>(name, callback)</span><br><span class="line">      <span class="keyword">else</span> <span class="variable language_">this</span>.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>[name]()</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//根据参数创建一个event对象</span></span><br><span class="line">  $.<span class="title class_">Event</span> = <span class="keyword">function</span>(<span class="params">type, props</span>) &#123;</span><br><span class="line">    <span class="comment">//当type是个对象时</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> type != <span class="string">&#x27;string&#x27;</span>) props = type, type = props.<span class="property">type</span></span><br><span class="line">    <span class="comment">//创建一个event对象，如果是click,mouseover,mouseout时，创建的是MouseEvent,bubbles为是否冒泡</span></span><br><span class="line">    <span class="keyword">var</span> event = <span class="variable language_">document</span>.<span class="title function_">createEvent</span>(specialEvents[type] || <span class="string">&#x27;Events&#x27;</span>),</span><br><span class="line">      bubbles = <span class="literal">true</span></span><br><span class="line">      <span class="comment">//确保bubbles的值为true或false,并将props参数的属性扩展到新创建的event对象上</span></span><br><span class="line">    <span class="keyword">if</span> (props) <span class="keyword">for</span> (<span class="keyword">var</span> name <span class="keyword">in</span> props)(name == <span class="string">&#x27;bubbles&#x27;</span>) ? (bubbles = !! props[name]) : (event[name] = props[name])</span><br><span class="line">    <span class="comment">//初始化event对象，type为事件类型，如click，bubbles为是否冒泡，第三个参数表示是否可以用preventDefault方法来取消默认操作</span></span><br><span class="line">    event.<span class="title function_">initEvent</span>(type, bubbles, <span class="literal">true</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>)</span><br><span class="line">    <span class="comment">//添加isDefaultPrevented方法，event.defaultPrevented返回一个布尔值,表明当前事件的默认动作是否被取消,也就是是否执行了 event.preventDefault()方法.</span></span><br><span class="line">    event.<span class="property">isDefaultPrevented</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">defaultPrevented</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> event</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)(<span class="title class_">Zepto</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  Ajax处理部份</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line">;</span><br><span class="line">(<span class="keyword">function</span>(<span class="params">$</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> jsonpID = <span class="number">0</span>,</span><br><span class="line">    <span class="variable language_">document</span> = <span class="variable language_">window</span>.<span class="property">document</span>,</span><br><span class="line">    key,</span><br><span class="line">    name,</span><br><span class="line">    rscript = <span class="regexp">/&lt;script\b[^&lt;]*(?:(?!&lt;\/script&gt;)&lt;[^&lt;]*)*&lt;\/script&gt;/gi</span>,</span><br><span class="line">    scriptTypeRE = <span class="regexp">/^(?:text|application)\/javascript/i</span>,</span><br><span class="line">    xmlTypeRE = <span class="regexp">/^(?:text|application)\/xml/i</span>,</span><br><span class="line">    jsonType = <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">    htmlType = <span class="string">&#x27;text/html&#x27;</span>,</span><br><span class="line">    blankRE = <span class="regexp">/^\s*$/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// trigger a custom event and return false if it was cancelled</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">triggerAndReturn</span>(<span class="params">context, eventName, data</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> event = $.<span class="title class_">Event</span>(eventName)</span><br><span class="line">      $(context).<span class="title function_">trigger</span>(event, data)</span><br><span class="line">      <span class="keyword">return</span> !event.<span class="property">defaultPrevented</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// trigger an Ajax &quot;global&quot; event</span></span><br><span class="line">    <span class="comment">//触发 ajax的全局事件</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">triggerGlobal</span>(<span class="params">settings, context, eventName, data</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (settings.<span class="property">global</span>) <span class="keyword">return</span> <span class="title function_">triggerAndReturn</span>(context || <span class="variable language_">document</span>, eventName, data)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Number of active Ajax requests</span></span><br><span class="line">    $.active = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//settings.global为true时表示需要触发全局ajax事件</span></span><br><span class="line">    <span class="comment">//注意这里的$.active++ === 0很巧妙，用它来判断开始，因为只有$.active等于0时$.active++ === 0才成立</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">ajaxStart</span>(<span class="params">settings</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (settings.<span class="property">global</span> &amp;&amp; $.active++ === <span class="number">0</span>) <span class="title function_">triggerGlobal</span>(settings, <span class="literal">null</span>, <span class="string">&#x27;ajaxStart&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//注意这里的 !(--$.active)同上面的异曲同工，--$.active为0，则表示$.active的值为1，这样用来判断结束，也很有意思</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">ajaxStop</span>(<span class="params">settings</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (settings.<span class="property">global</span> &amp;&amp; !(--$.active)) <span class="title function_">triggerGlobal</span>(settings, <span class="literal">null</span>, <span class="string">&#x27;ajaxStop&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// triggers an extra global event &quot;ajaxBeforeSend&quot; that&#x27;s like &quot;ajaxSend&quot; but cancelable</span></span><br><span class="line">    <span class="comment">//触发全局ajaxBeforeSend事件，如果返回false,则取消此次请求</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">ajaxBeforeSend</span>(<span class="params">xhr, settings</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> context = settings.<span class="property">context</span></span><br><span class="line">      <span class="keyword">if</span> (settings.<span class="property">beforeSend</span>.<span class="title function_">call</span>(context, xhr, settings) === <span class="literal">false</span> || <span class="title function_">triggerGlobal</span>(settings, context, <span class="string">&#x27;ajaxBeforeSend&#x27;</span>, [xhr, settings]) === <span class="literal">false</span>) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">      <span class="title function_">triggerGlobal</span>(settings, context, <span class="string">&#x27;ajaxSend&#x27;</span>, [xhr, settings])</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">ajaxSuccess</span>(<span class="params">data, xhr, settings</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> context = settings.<span class="property">context</span>,</span><br><span class="line">        status = <span class="string">&#x27;success&#x27;</span></span><br><span class="line">      settings.<span class="property">success</span>.<span class="title function_">call</span>(context, data, status, xhr)</span><br><span class="line">      <span class="title function_">triggerGlobal</span>(settings, context, <span class="string">&#x27;ajaxSuccess&#x27;</span>, [xhr, settings, data])</span><br><span class="line">      <span class="title function_">ajaxComplete</span>(status, xhr, settings)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// type: &quot;timeout&quot;, &quot;error&quot;, &quot;abort&quot;, &quot;parsererror&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">ajaxError</span>(<span class="params">error, type, xhr, settings</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> context = settings.<span class="property">context</span></span><br><span class="line">      settings.<span class="property">error</span>.<span class="title function_">call</span>(context, xhr, type, error)</span><br><span class="line">      <span class="title function_">triggerGlobal</span>(settings, context, <span class="string">&#x27;ajaxError&#x27;</span>, [xhr, settings, error])</span><br><span class="line">      <span class="title function_">ajaxComplete</span>(type, xhr, settings)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// status: &quot;success&quot;, &quot;notmodified&quot;, &quot;error&quot;, &quot;timeout&quot;, &quot;abort&quot;, &quot;parsererror&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">ajaxComplete</span>(<span class="params">status, xhr, settings</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> context = settings.<span class="property">context</span></span><br><span class="line">      settings.<span class="property">complete</span>.<span class="title function_">call</span>(context, xhr, status)</span><br><span class="line">      <span class="title function_">triggerGlobal</span>(settings, context, <span class="string">&#x27;ajaxComplete&#x27;</span>, [xhr, settings])</span><br><span class="line">      <span class="title function_">ajaxStop</span>(settings)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Empty function, used as default callback</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">empty</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">    <span class="comment">//可参考http://zh.wikipedia.org/zh-cn/JSONP</span></span><br><span class="line">    $.ajaxJSONP = <span class="keyword">function</span>(<span class="params">options</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!(<span class="string">&#x27;type&#x27;</span> <span class="keyword">in</span> options)) <span class="keyword">return</span> $.<span class="title function_">ajax</span>(options)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> callbackName = <span class="string">&#x27;jsonp&#x27;</span> + (++jsonpID), <span class="comment">//创建回调函数名</span></span><br><span class="line">        script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;script&#x27;</span>),</span><br><span class="line">        <span class="comment">//js文件加载完毕</span></span><br><span class="line">        cleanup = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="built_in">clearTimeout</span>(abortTimeout) <span class="comment">//清除下面的timeout事件处理</span></span><br><span class="line">          $(script).<span class="title function_">remove</span>() <span class="comment">//移除创建的script标签，因为该文件的JS内容已经解析过了</span></span><br><span class="line">          <span class="keyword">delete</span> <span class="variable language_">window</span>[callbackName] <span class="comment">//清除掉指定的回调函数</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">//取消加载</span></span><br><span class="line">        abort = <span class="keyword">function</span>(<span class="params">type</span>) &#123;</span><br><span class="line">          <span class="title function_">cleanup</span>()</span><br><span class="line">          <span class="comment">// In case of manual abort or timeout, keep an empty function as callback</span></span><br><span class="line">          <span class="comment">// so that the SCRIPT tag that eventually loads won&#x27;t result in an error.</span></span><br><span class="line">          <span class="comment">//这里通过将回调函数重新赋值为空函数来达到看似阻止加载JS的目的，实际上给script标签设置了src属性后，请求就已经产生了，并且不能中断</span></span><br><span class="line">          <span class="keyword">if</span> (!type || type == <span class="string">&#x27;timeout&#x27;</span>) <span class="variable language_">window</span>[callbackName] = empty</span><br><span class="line">          <span class="title function_">ajaxError</span>(<span class="literal">null</span>, type || <span class="string">&#x27;abort&#x27;</span>, xhr, options)</span><br><span class="line">        &#125;,</span><br><span class="line">        xhr = &#123;</span><br><span class="line">          <span class="attr">abort</span>: abort</span><br><span class="line">        &#125;, abortTimeout</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_">ajaxBeforeSend</span>(xhr, options) === <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="title function_">abort</span>(<span class="string">&#x27;abort&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//成功加载后的回调函数</span></span><br><span class="line">      <span class="variable language_">window</span>[callbackName] = <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">        <span class="title function_">cleanup</span>()</span><br><span class="line">        <span class="title function_">ajaxSuccess</span>(data, xhr, options)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      script.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">abort</span>(<span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//将回调函数名追加到请求地址，并赋给script，至此请求产生</span></span><br><span class="line">      script.<span class="property">src</span> = options.<span class="property">url</span>.<span class="title function_">replace</span>(<span class="regexp">/=\?/</span>, <span class="string">&#x27;=&#x27;</span> + callbackName)</span><br><span class="line">      $(<span class="string">&#x27;head&#x27;</span>).<span class="title function_">append</span>(script)</span><br><span class="line"></span><br><span class="line">      <span class="comment">//如果设置了超时处理</span></span><br><span class="line">      <span class="keyword">if</span> (options.<span class="property">timeout</span> &gt; <span class="number">0</span>) abortTimeout = <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">abort</span>(<span class="string">&#x27;timeout&#x27;</span>)</span><br><span class="line">      &#125;, options.<span class="property">timeout</span>)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> xhr</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ajax全局设置</span></span><br><span class="line">    $.ajaxSettings = &#123;</span><br><span class="line">      <span class="comment">// Default type of request</span></span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">      <span class="comment">// Callback that is executed before request</span></span><br><span class="line">      <span class="attr">beforeSend</span>: empty,</span><br><span class="line">      <span class="comment">// Callback that is executed if the request succeeds</span></span><br><span class="line">      <span class="attr">success</span>: empty,</span><br><span class="line">      <span class="comment">// Callback that is executed the the server drops error</span></span><br><span class="line">      <span class="attr">error</span>: empty,</span><br><span class="line">      <span class="comment">// Callback that is executed on request complete (both: error and success)</span></span><br><span class="line">      <span class="attr">complete</span>: empty,</span><br><span class="line">      <span class="comment">// The context for the callbacks</span></span><br><span class="line">      <span class="attr">context</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="comment">// Whether to trigger &quot;global&quot; Ajax events</span></span><br><span class="line">      <span class="attr">global</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// Transport</span></span><br><span class="line">      <span class="attr">xhr</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="variable language_">window</span>.<span class="title class_">XMLHttpRequest</span>()</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// MIME types mapping</span></span><br><span class="line">      <span class="attr">accepts</span>: &#123;</span><br><span class="line">        <span class="attr">script</span>: <span class="string">&#x27;text/javascript, application/javascript&#x27;</span>,</span><br><span class="line">        <span class="attr">json</span>: jsonType,</span><br><span class="line">        <span class="attr">xml</span>: <span class="string">&#x27;application/xml, text/xml&#x27;</span>,</span><br><span class="line">        <span class="attr">html</span>: htmlType,</span><br><span class="line">        <span class="attr">text</span>: <span class="string">&#x27;text/plain&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// Whether the request is to another domain</span></span><br><span class="line">      <span class="attr">crossDomain</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="comment">// Default timeout</span></span><br><span class="line">      <span class="attr">timeout</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="comment">// Whether data should be serialized to string</span></span><br><span class="line">      <span class="attr">processData</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// Whether the browser should be allowed to cache GET responses</span></span><br><span class="line">      <span class="attr">cache</span>: <span class="literal">true</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//根据MIME返回相应的数据类型，用作ajax参数里的dataType用，设置预期返回的数据类型</span></span><br><span class="line">  <span class="comment">//如html,json,scirpt,xml,text</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">mimeToDataType</span>(<span class="params">mime</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (mime) mime = mime.<span class="title function_">split</span>(<span class="string">&#x27;;&#x27;</span>, <span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> mime &amp;&amp; (mime == htmlType ? <span class="string">&#x27;html&#x27;</span> : mime == jsonType ? <span class="string">&#x27;json&#x27;</span> : scriptTypeRE.<span class="title function_">test</span>(mime) ? <span class="string">&#x27;script&#x27;</span> : xmlTypeRE.<span class="title function_">test</span>(mime) &amp;&amp; <span class="string">&#x27;xml&#x27;</span>) || <span class="string">&#x27;text&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//将查询字符串追加到URL后面</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">appendQuery</span>(<span class="params">url, query</span>) &#123;</span><br><span class="line">    <span class="comment">//注意这里的replace,将第一个匹配到的&amp;或者&amp;&amp;,&amp;?,? ?&amp; ??替换成?,用来保证地址的正确性</span></span><br><span class="line">    <span class="keyword">return</span> (url + <span class="string">&#x27;&amp;&#x27;</span> + query).<span class="title function_">replace</span>(<span class="regexp">/[&amp;?]&#123;1,2&#125;/</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// serialize payload and append it to the URL for GET requests</span></span><br><span class="line">  <span class="comment">//序列化发送到服务器上的数据，如果是GET请求，则将序列化后的数据追加到请求地址后面</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">serializeData</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="comment">//options.processData表示对于非Get请求,是否自动将 options.data转换为字符串,前提是options.data不是字符串</span></span><br><span class="line">    <span class="keyword">if</span> (options.<span class="property">processData</span> &amp;&amp; options.<span class="property">data</span> &amp;&amp; $.<span class="title function_">type</span>(options.<span class="property">data</span>) != <span class="string">&quot;string&quot;</span>)</span><br><span class="line">    <span class="comment">//options.traditional表示是否以$.param方法序列化</span></span><br><span class="line">    options.<span class="property">data</span> = $.<span class="title function_">param</span>(options.<span class="property">data</span>, options.<span class="property">traditional</span>)</span><br><span class="line">    <span class="keyword">if</span> (options.<span class="property">data</span> &amp;&amp; (!options.<span class="property">type</span> || options.<span class="property">type</span>.<span class="title function_">toUpperCase</span>() == <span class="string">&#x27;GET&#x27;</span>))</span><br><span class="line">    <span class="comment">//如果是GET请求，将序列化后的数据追加到请求地址后面</span></span><br><span class="line">    options.<span class="property">url</span> = <span class="title function_">appendQuery</span>(options.<span class="property">url</span>, options.<span class="property">data</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.ajax = <span class="keyword">function</span>(<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="comment">//注意这里不能直接将$.ajaxSettings替换掉$.extend的第一个参数,这样会改变 $.ajaxSettings里面的值</span></span><br><span class="line">    <span class="comment">//这里的做法是创建一个新对象</span></span><br><span class="line">    <span class="keyword">var</span> settings = $.<span class="title function_">extend</span>(&#123;&#125;, options || &#123;&#125;)</span><br><span class="line">    <span class="comment">//如果它没有定义$.ajaxSettings里面的属性的时候，才去将$.ajaxSettings[key] 复制过来</span></span><br><span class="line">    <span class="keyword">for</span> (key <span class="keyword">in</span> $.ajaxSettings) <span class="keyword">if</span> (settings[key] === <span class="literal">undefined</span>) settings[key] = $.ajaxSettings[key]</span><br><span class="line">    <span class="comment">//执行全局ajaxStart</span></span><br><span class="line">    <span class="title function_">ajaxStart</span>(settings)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过判断请求地址和当前页面地址的host是否相同来设置是跨域</span></span><br><span class="line">    <span class="keyword">if</span> (!settings.<span class="property">crossDomain</span>) settings.<span class="property">crossDomain</span> = <span class="regexp">/^([\w-]+:)?\/\/([^\/]+)/</span>.<span class="title function_">test</span>(settings.<span class="property">url</span>) &amp;&amp; <span class="title class_">RegExp</span>.<span class="property">$2</span> != <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">host</span></span><br><span class="line">    <span class="comment">//如果没有设置请求地址，则取当前页面地址</span></span><br><span class="line">    <span class="keyword">if</span> (!settings.<span class="property">url</span>) settings.<span class="property">url</span> = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">toString</span>();</span><br><span class="line">    <span class="comment">//将data进行转换</span></span><br><span class="line">    <span class="title function_">serializeData</span>(settings);</span><br><span class="line">    <span class="comment">//如果不设置缓存</span></span><br><span class="line">    <span class="keyword">if</span> (settings.<span class="property">cache</span> === <span class="literal">false</span>) settings.<span class="property">url</span> = <span class="title function_">appendQuery</span>(settings.<span class="property">url</span>, <span class="string">&#x27;_=&#x27;</span> + <span class="title class_">Date</span>.<span class="title function_">now</span>())</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果请求的是jsonp，则将地址栏里的=?替换为callback=?,相当于一个简写</span></span><br><span class="line">    <span class="keyword">var</span> dataType = settings.<span class="property">dataType</span>,</span><br><span class="line">      hasPlaceholder = <span class="regexp">/=\?/</span>.<span class="title function_">test</span>(settings.<span class="property">url</span>)</span><br><span class="line">      <span class="keyword">if</span> (dataType == <span class="string">&#x27;jsonp&#x27;</span> || hasPlaceholder) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!hasPlaceholder) settings.<span class="property">url</span> = <span class="title function_">appendQuery</span>(settings.<span class="property">url</span>, <span class="string">&#x27;callback=?&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> $.<span class="title function_">ajaxJSONP</span>(settings)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> mime = settings.<span class="property">accepts</span>[dataType],</span><br><span class="line">      baseHeaders = &#123;&#125;,</span><br><span class="line">      <span class="comment">//如果请求地址没有定请求协议，则与当前页面协议相同</span></span><br><span class="line">      protocol = <span class="regexp">/^([\w-]+:)\/\//</span>.<span class="title function_">test</span>(settings.<span class="property">url</span>) ? <span class="title class_">RegExp</span>.<span class="property">$1</span> : <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">protocol</span>,</span><br><span class="line">      xhr = settings.<span class="title function_">xhr</span>(),</span><br><span class="line">      abortTimeout</span><br><span class="line">      <span class="comment">//如果没有跨域</span></span><br><span class="line">    <span class="keyword">if</span> (!settings.<span class="property">crossDomain</span>) baseHeaders[<span class="string">&#x27;X-Requested-With&#x27;</span>] = <span class="string">&#x27;XMLHttpRequest&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> (mime) &#123;</span><br><span class="line">      baseHeaders[<span class="string">&#x27;Accept&#x27;</span>] = mime</span><br><span class="line">      <span class="keyword">if</span> (mime.<span class="title function_">indexOf</span>(<span class="string">&#x27;,&#x27;</span>) &gt; -<span class="number">1</span>) mime = mime.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>, <span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">      xhr.<span class="property">overrideMimeType</span> &amp;&amp; xhr.<span class="title function_">overrideMimeType</span>(mime)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果不是GET请求，设置发送信息至服务器时内容编码类型</span></span><br><span class="line">    <span class="keyword">if</span> (settings.<span class="property">contentType</span> || (settings.<span class="property">contentType</span> !== <span class="literal">false</span> &amp;&amp; settings.<span class="property">data</span> &amp;&amp; settings.<span class="property">type</span>.<span class="title function_">toUpperCase</span>() != <span class="string">&#x27;GET&#x27;</span>)) baseHeaders[<span class="string">&#x27;Content-Type&#x27;</span>] = (settings.<span class="property">contentType</span> || <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>)</span><br><span class="line">    settings.<span class="property">headers</span> = $.<span class="title function_">extend</span>(baseHeaders, settings.<span class="property">headers</span> || &#123;&#125;)</span><br><span class="line"></span><br><span class="line">    xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (xhr.<span class="property">readyState</span> == <span class="number">4</span>) &#123;</span><br><span class="line">        xhr.<span class="property">onreadystatechange</span> = empty;</span><br><span class="line">        <span class="built_in">clearTimeout</span>(abortTimeout)</span><br><span class="line">        <span class="keyword">var</span> result, error = <span class="literal">false</span></span><br><span class="line">        <span class="comment">//根据状态来判断请求是否成功</span></span><br><span class="line">        <span class="comment">//状态&gt;=200 &amp;&amp; &lt; 300 表示成功</span></span><br><span class="line">        <span class="comment">//状态 == 304 表示文件未改动过，也可认为成功</span></span><br><span class="line">        <span class="comment">//如果是取要本地文件那也可以认为是成功的，xhr.status == 0是在直接打开页面时发生请求时出现的状态，也就是不是用localhost的形式访问的页面的情况</span></span><br><span class="line">        <span class="keyword">if</span> ((xhr.<span class="property">status</span> &gt;= <span class="number">200</span> &amp;&amp; xhr.<span class="property">status</span> &lt; <span class="number">300</span>) || xhr.<span class="property">status</span> == <span class="number">304</span> || (xhr.<span class="property">status</span> == <span class="number">0</span> &amp;&amp; protocol == <span class="string">&#x27;file:&#x27;</span>)) &#123;</span><br><span class="line">          <span class="comment">//获取返回的数据类型</span></span><br><span class="line">          dataType = dataType || <span class="title function_">mimeToDataType</span>(xhr.<span class="title function_">getResponseHeader</span>(<span class="string">&#x27;content-type&#x27;</span>))</span><br><span class="line">          result = xhr.<span class="property">responseText</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// http://perfectionkills.com/global-eval-what-are-the-options/</span></span><br><span class="line">            <span class="keyword">if</span> (dataType == <span class="string">&#x27;script&#x27;</span>)(<span class="number">1</span>, <span class="built_in">eval</span>)(result) <span class="comment">//如果返回的数据类型是JS</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (dataType == <span class="string">&#x27;xml&#x27;</span>) result = xhr.<span class="property">responseXML</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (dataType == <span class="string">&#x27;json&#x27;</span>) result = blankRE.<span class="title function_">test</span>(result) ? <span class="literal">null</span> : $.<span class="title function_">parseJSON</span>(result)</span><br><span class="line">          &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            error = e</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">//如果解析出错，则执行全局parsererror事件</span></span><br><span class="line">          <span class="keyword">if</span> (error) <span class="title function_">ajaxError</span>(error, <span class="string">&#x27;parsererror&#x27;</span>, xhr, settings)</span><br><span class="line">          <span class="comment">//否则执行ajaxSuccess</span></span><br><span class="line">          <span class="keyword">else</span> <span class="title function_">ajaxSuccess</span>(result, xhr, settings)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">//如果请求出错，则根据xhr.status来执行相应的错误处理函数</span></span><br><span class="line">          <span class="title function_">ajaxError</span>(<span class="literal">null</span>, xhr.<span class="property">status</span> ? <span class="string">&#x27;error&#x27;</span> : <span class="string">&#x27;abort&#x27;</span>, xhr, settings)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">async</span> = <span class="string">&#x27;async&#x27;</span> <span class="keyword">in</span> settings ? settings.<span class="property">async</span> : <span class="literal">true</span></span><br><span class="line">    xhr.<span class="title function_">open</span>(settings.<span class="property">type</span>, settings.<span class="property">url</span>, <span class="keyword">async</span>)</span><br><span class="line">    <span class="comment">//设置请求头信息</span></span><br><span class="line">    <span class="keyword">for</span> (name <span class="keyword">in</span> settings.<span class="property">headers</span>) xhr.<span class="title function_">setRequestHeader</span>(name, settings.<span class="property">headers</span>[name])</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果ajaxBeforeSend函数返回的false，则取消此次请示</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">ajaxBeforeSend</span>(xhr, settings) === <span class="literal">false</span>) &#123;</span><br><span class="line">      xhr.<span class="title function_">abort</span>()</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//当设置了settings.timeout，则在超时后取消请求，并执行timeout事件处理函数</span></span><br><span class="line">    <span class="keyword">if</span> (settings.<span class="property">timeout</span> &gt; <span class="number">0</span>) abortTimeout = <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      xhr.<span class="property">onreadystatechange</span> = empty</span><br><span class="line">      xhr.<span class="title function_">abort</span>()</span><br><span class="line">      <span class="title function_">ajaxError</span>(<span class="literal">null</span>, <span class="string">&#x27;timeout&#x27;</span>, xhr, settings)</span><br><span class="line">    &#125;, settings.<span class="property">timeout</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// avoid sending empty string (#319)</span></span><br><span class="line">    xhr.<span class="title function_">send</span>(settings.<span class="property">data</span> ? settings.<span class="property">data</span> : <span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">return</span> xhr</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// handle optional data/success arguments</span></span><br><span class="line">  <span class="comment">//将参数转换成ajax函数指定的参数格式</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">parseArguments</span>(<span class="params">url, data, success, dataType</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> hasData = !$.<span class="title function_">isFunction</span>(data) <span class="comment">//如果data是function，则认为它是请求成功后的回调</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">url</span>: url,</span><br><span class="line">      <span class="attr">data</span>: hasData ? data : <span class="literal">undefined</span>, <span class="comment">//如果data不是function实例</span></span><br><span class="line">      <span class="attr">success</span>: !hasData ? data : $.<span class="title function_">isFunction</span>(success) ? success : <span class="literal">undefined</span>,</span><br><span class="line">      <span class="attr">dataType</span>: hasData ? dataType || success : success</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//简单的get请求</span></span><br><span class="line">  $.get = <span class="keyword">function</span>(<span class="params">url, data, success, dataType</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> $.<span class="title function_">ajax</span>(parseArguments.<span class="title function_">apply</span>(<span class="literal">null</span>, <span class="variable language_">arguments</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.post = <span class="keyword">function</span>(<span class="params">url, data, success, dataType</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> options = parseArguments.<span class="title function_">apply</span>(<span class="literal">null</span>, <span class="variable language_">arguments</span>)</span><br><span class="line">    options.<span class="property">type</span> = <span class="string">&#x27;POST&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> $.<span class="title function_">ajax</span>(options)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.getJSON = <span class="keyword">function</span>(<span class="params">url, data, success</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> options = parseArguments.<span class="title function_">apply</span>(<span class="literal">null</span>, <span class="variable language_">arguments</span>)</span><br><span class="line">    options.<span class="property">dataType</span> = <span class="string">&#x27;json&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> $.<span class="title function_">ajax</span>(options)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//这里的url可以是http://www.xxxx.com selector这种形式，就是对加载进来的HTML对行一个筛选</span></span><br><span class="line">  $.fn.<span class="property">load</span> = <span class="keyword">function</span>(<span class="params">url, data, success</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">length</span>) <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">    <span class="comment">//将请求地址用空格分开</span></span><br><span class="line">    <span class="keyword">var</span> self = <span class="variable language_">this</span>,</span><br><span class="line">      parts = url.<span class="title function_">split</span>(<span class="regexp">/\s/</span>),</span><br><span class="line">      selector,</span><br><span class="line">      options = <span class="title function_">parseArguments</span>(url, data, success),</span><br><span class="line">      callback = options.<span class="property">success</span></span><br><span class="line">    <span class="keyword">if</span> (parts.<span class="property">length</span> &gt; <span class="number">1</span>) options.<span class="property">url</span> = parts[<span class="number">0</span>], selector = parts[<span class="number">1</span>]</span><br><span class="line">    <span class="comment">//要对成功后的回调函数进行一个改写，因为需要将加载进来的HTML添加进当前集合</span></span><br><span class="line">    options.<span class="property">success</span> = <span class="keyword">function</span>(<span class="params">response</span>) &#123;</span><br><span class="line">      <span class="comment">//selector就是对请求到的数据就行一个筛选的条件，比如只获取数据里的类名为.test的标签</span></span><br><span class="line">      self.<span class="title function_">html</span>(selector ? $(<span class="string">&#x27;&lt;div&gt;&#x27;</span>).<span class="title function_">html</span>(response.<span class="title function_">replace</span>(rscript, <span class="string">&quot;&quot;</span>)).<span class="title function_">find</span>(selector) : response)</span><br><span class="line">      <span class="comment">//这里才是你写的回调</span></span><br><span class="line">      callback &amp;&amp; callback.<span class="title function_">apply</span>(self, <span class="variable language_">arguments</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    $.<span class="title function_">ajax</span>(options)</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> <span class="built_in">escape</span> = <span class="built_in">encodeURIComponent</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">serialize</span>(<span class="params">params, obj, traditional, scope</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> type, array = $.<span class="title function_">isArray</span>(obj)</span><br><span class="line">      $.<span class="title function_">each</span>(obj, <span class="keyword">function</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">        type = $.<span class="title function_">type</span>(value)</span><br><span class="line">        <span class="comment">//scope用作处理value也是object或者array的情况</span></span><br><span class="line">        <span class="comment">//traditional表示是否以传统的方式拼接数据，</span></span><br><span class="line">        <span class="comment">//传统的意思就是比如现有一个数据&#123;a:[1,2,3]&#125;,转成查询字符串后结果为&#x27;a=1&amp;a=2&amp;a=3&#x27;</span></span><br><span class="line">        <span class="comment">//非传统的的结果则是a[]=1&amp;a[]=2&amp;a[]=3</span></span><br><span class="line">        <span class="keyword">if</span> (scope) key = traditional ? scope : scope + <span class="string">&#x27;[&#x27;</span> + (array ? <span class="string">&#x27;&#x27;</span> : key) + <span class="string">&#x27;]&#x27;</span></span><br><span class="line">        <span class="comment">// handle data in serializeArray() format</span></span><br><span class="line">        <span class="comment">//当处理的数据为[&#123;&#125;,&#123;&#125;,&#123;&#125;]这种情况的时候，一般指的是序列化表单后的结果</span></span><br><span class="line">        <span class="keyword">if</span> (!scope &amp;&amp; array) params.<span class="title function_">add</span>(value.<span class="property">name</span>, value.<span class="property">value</span>)</span><br><span class="line">        <span class="comment">// recurse into nested objects</span></span><br><span class="line">        <span class="comment">//当value值是数组或者是对象且不是按传统的方式序列化的时候，需要再次遍历value</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (type == <span class="string">&quot;array&quot;</span> || (!traditional &amp;&amp; type == <span class="string">&quot;object&quot;</span>)) <span class="title function_">serialize</span>(params, value, traditional, key)</span><br><span class="line">        <span class="keyword">else</span> params.<span class="title function_">add</span>(key, value)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//将obj转换为查询字符串的格式，traditional表示是否转换成传统的方式，至于传统的方式的意思看上面的注释</span></span><br><span class="line">    $.param = <span class="keyword">function</span>(<span class="params">obj, traditional</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> params = []</span><br><span class="line">      <span class="comment">//注意这里将add方法定到params，所以下面serialize时才不需要返回数据</span></span><br><span class="line">      params.<span class="property">add</span> = <span class="keyword">function</span>(<span class="params">k, v</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">push</span>(<span class="built_in">escape</span>(k) + <span class="string">&#x27;=&#x27;</span> + <span class="built_in">escape</span>(v))</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">serialize</span>(params, obj, traditional)</span><br><span class="line">      <span class="keyword">return</span> params.<span class="title function_">join</span>(<span class="string">&#x27;&amp;&#x27;</span>).<span class="title function_">replace</span>(<span class="regexp">/%20/g</span>, <span class="string">&#x27;+&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)(<span class="title class_">Zepto</span>)</span><br><span class="line"></span><br><span class="line">;</span><br><span class="line">(<span class="keyword">function</span>(<span class="params">$</span>) &#123;</span><br><span class="line">  <span class="comment">//序列化表单，返回一个类似[&#123;name:value&#125;,&#123;name2:value2&#125;]的数组</span></span><br><span class="line">  $.fn.<span class="property">serializeArray</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> result = [],</span><br><span class="line">      el</span><br><span class="line">      <span class="comment">//将集合中的第一个表单里的所有表单元素转成数组后进行遍历</span></span><br><span class="line">      $(<span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>.<span class="title function_">get</span>(<span class="number">0</span>).<span class="property">elements</span>)).<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        el = $(<span class="variable language_">this</span>)</span><br><span class="line">        <span class="keyword">var</span> type = el.<span class="title function_">attr</span>(<span class="string">&#x27;type&#x27;</span>)</span><br><span class="line">        <span class="comment">//判断其type属性，排除fieldset，submi,reset,button以及没有被选中的radio和checkbox</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">nodeName</span>.<span class="title function_">toLowerCase</span>() != <span class="string">&#x27;fieldset&#x27;</span> &amp;&amp; !<span class="variable language_">this</span>.<span class="property">disabled</span> &amp;&amp; type != <span class="string">&#x27;submit&#x27;</span> &amp;&amp; type != <span class="string">&#x27;reset&#x27;</span> &amp;&amp; type != <span class="string">&#x27;button&#x27;</span> &amp;&amp;</span><br><span class="line">        <span class="comment">//注意这里的写法，当元素既不是radio也不是checkbox时,直接返回true，</span></span><br><span class="line">        <span class="comment">//当元素是radio或者checkbox时，会执行后面的this.checked，当radio或者checkbox被选中时this.checked得到true值</span></span><br><span class="line">        <span class="comment">//这样就可以筛选中被选中的radio和checkbox了</span></span><br><span class="line">        ((type != <span class="string">&#x27;radio&#x27;</span> &amp;&amp; type != <span class="string">&#x27;checkbox&#x27;</span>) || <span class="variable language_">this</span>.<span class="property">checked</span>)) result.<span class="title function_">push</span>(&#123;</span><br><span class="line">          <span class="attr">name</span>: el.<span class="title function_">attr</span>(<span class="string">&#x27;name&#x27;</span>),</span><br><span class="line">          <span class="attr">value</span>: el.<span class="title function_">val</span>()</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//将表单的值转成name1=value1&amp;name2=value2的形式</span></span><br><span class="line">  $.fn.<span class="property">serialize</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> result = []</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">serializeArray</span>().<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">elm</span>) &#123;</span><br><span class="line">      result.<span class="title function_">push</span>(<span class="built_in">encodeURIComponent</span>(elm.<span class="property">name</span>) + <span class="string">&#x27;=&#x27;</span> + <span class="built_in">encodeURIComponent</span>(elm.<span class="property">value</span>))</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> result.<span class="title function_">join</span>(<span class="string">&#x27;&amp;&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//表单提交</span></span><br><span class="line">  $.fn.<span class="property">submit</span> = <span class="keyword">function</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (callback) <span class="variable language_">this</span>.<span class="title function_">bind</span>(<span class="string">&#x27;submit&#x27;</span>, callback)</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> event = $.<span class="title class_">Event</span>(<span class="string">&#x27;submit&#x27;</span>)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">eq</span>(<span class="number">0</span>).<span class="title function_">trigger</span>(event)</span><br><span class="line">      <span class="keyword">if</span> (!event.<span class="property">defaultPrevented</span>) <span class="variable language_">this</span>.<span class="title function_">get</span>(<span class="number">0</span>).<span class="title function_">submit</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;)(<span class="title class_">Zepto</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//CSS3动画</span></span><br><span class="line">;</span><br><span class="line">(<span class="keyword">function</span>(<span class="params">$, <span class="literal">undefined</span></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> prefix = <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    eventPrefix, endEventName, endAnimationName,</span><br><span class="line">    vendors = &#123;</span><br><span class="line">      <span class="title class_">Webkit</span>: <span class="string">&#x27;webkit&#x27;</span>,</span><br><span class="line">      <span class="title class_">Moz</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="attr">O</span>: <span class="string">&#x27;o&#x27;</span>,</span><br><span class="line">      <span class="attr">ms</span>: <span class="string">&#x27;MS&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="variable language_">document</span> = <span class="variable language_">window</span>.<span class="property">document</span>,</span><br><span class="line">    testEl = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>),</span><br><span class="line">    supportedTransforms = <span class="regexp">/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i</span>,</span><br><span class="line">    transform,</span><br><span class="line">    transitionProperty, transitionDuration, transitionTiming,</span><br><span class="line">    animationName, animationDuration, animationTiming,</span><br><span class="line">    cssReset = &#123;&#125;</span><br><span class="line">    <span class="comment">//将驼峰式的字符串转成用-分隔的小写形式，如borderWidth ==&gt; border-width</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">dasherize</span>(<span class="params">str</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">downcase</span>(str.<span class="title function_">replace</span>(<span class="regexp">/([a-z])([A-Z])/</span>, <span class="string">&#x27;$1-$2&#x27;</span>))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">downcase</span>(<span class="params">str</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> str.<span class="title function_">toLowerCase</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//用于修正事件名</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">normalizeEvent</span>(<span class="params">name</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> eventPrefix ? eventPrefix + name : <span class="title function_">downcase</span>(name)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据浏览器的特性设置CSS属性前轻辍和事件前辍，比如浏览器内核是webkit</span></span><br><span class="line">    <span class="comment">//那么用于设置CSS属性的前辍prefix就等于&#x27;-webkit-&#x27;,用来修正事件名的前辍eventPrefix就是Webkit</span></span><br><span class="line">    $.<span class="title function_">each</span>(vendors, <span class="keyword">function</span>(<span class="params">vendor, event</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (testEl.<span class="property">style</span>[vendor + <span class="string">&#x27;TransitionProperty&#x27;</span>] !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">        prefix = <span class="string">&#x27;-&#x27;</span> + <span class="title function_">downcase</span>(vendor) + <span class="string">&#x27;-&#x27;</span></span><br><span class="line">        eventPrefix = event</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    transform = prefix + <span class="string">&#x27;transform&#x27;</span></span><br><span class="line">  cssReset[transitionProperty = prefix + <span class="string">&#x27;transition-property&#x27;</span>] = cssReset[transitionDuration = prefix + <span class="string">&#x27;transition-duration&#x27;</span>] = cssReset[transitionTiming = prefix + <span class="string">&#x27;transition-timing-function&#x27;</span>] = cssReset[animationName = prefix + <span class="string">&#x27;animation-name&#x27;</span>] = cssReset[animationDuration = prefix + <span class="string">&#x27;animation-duration&#x27;</span>] = cssReset[animationTiming = prefix + <span class="string">&#x27;animation-timing-function&#x27;</span>] = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">  $.fx = &#123;</span><br><span class="line">    <span class="attr">off</span>: (eventPrefix === <span class="literal">undefined</span> &amp;&amp; testEl.<span class="property">style</span>.<span class="property">transitionProperty</span> === <span class="literal">undefined</span>),</span><br><span class="line">    <span class="attr">speeds</span>: &#123;</span><br><span class="line">      <span class="attr">_default</span>: <span class="number">400</span>,</span><br><span class="line">      <span class="attr">fast</span>: <span class="number">200</span>,</span><br><span class="line">      <span class="attr">slow</span>: <span class="number">600</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">cssPrefix</span>: prefix,</span><br><span class="line">    <span class="attr">transitionEnd</span>: <span class="title function_">normalizeEvent</span>(<span class="string">&#x27;TransitionEnd&#x27;</span>),</span><br><span class="line">    <span class="attr">animationEnd</span>: <span class="title function_">normalizeEvent</span>(<span class="string">&#x27;AnimationEnd&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.fn.<span class="property">animate</span> = <span class="keyword">function</span>(<span class="params">properties, duration, ease, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> ($.<span class="title function_">isPlainObject</span>(duration)) ease = duration.<span class="property">easing</span>, callback = duration.<span class="property">complete</span>, duration = duration.<span class="property">duration</span></span><br><span class="line">    <span class="comment">//如果duration是数字时，表示动画持续时间，如果是字符串，则从$.fx.speeds中取出相对应的值，如果没有找到相应的值，对取默认值</span></span><br><span class="line">    <span class="keyword">if</span> (duration) duration = (<span class="keyword">typeof</span> duration == <span class="string">&#x27;number&#x27;</span> ? duration : ($.fx.<span class="property">speeds</span>[duration] || $.fx.<span class="property">speeds</span>.<span class="property">_default</span>)) / <span class="number">1000</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">anim</span>(properties, duration, ease, callback)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  $.fn.<span class="property">anim</span> = <span class="keyword">function</span>(<span class="params">properties, duration, ease, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> key, cssValues = &#123;&#125;, cssProperties, transforms = <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      that = <span class="variable language_">this</span>,</span><br><span class="line">      wrappedCallback, endEvent = $.fx.<span class="property">transitionEnd</span></span><br><span class="line">      <span class="comment">//动画持续时间默认值</span></span><br><span class="line">    <span class="keyword">if</span> (duration === <span class="literal">undefined</span>) duration = <span class="number">0.4</span></span><br><span class="line">    <span class="comment">//如果浏览器不支持CSS3的动画，则duration=0，意思就是直接跳转最终值</span></span><br><span class="line">    <span class="keyword">if</span> ($.fx.<span class="property">off</span>) duration = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果properties是一个动画名keyframe</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> properties == <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// keyframe animation</span></span><br><span class="line">      cssValues[animationName] = properties</span><br><span class="line">      cssValues[animationDuration] = duration + <span class="string">&#x27;s&#x27;</span></span><br><span class="line">      cssValues[animationTiming] = (ease || <span class="string">&#x27;linear&#x27;</span>)</span><br><span class="line">      endEvent = $.fx.<span class="property">animationEnd</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      cssProperties = []</span><br><span class="line">      <span class="comment">// CSS transitions</span></span><br><span class="line">      <span class="keyword">for</span> (key <span class="keyword">in</span> properties)</span><br><span class="line">      <span class="comment">//如果设置 的CSS属性是变形之类的</span></span><br><span class="line">      <span class="keyword">if</span> (supportedTransforms.<span class="title function_">test</span>(key)) transforms += key + <span class="string">&#x27;(&#x27;</span> + properties[key] + <span class="string">&#x27;) &#x27;</span></span><br><span class="line">      <span class="keyword">else</span> cssValues[key] = properties[key], cssProperties.<span class="title function_">push</span>(<span class="title function_">dasherize</span>(key))</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (transforms) cssValues[transform] = transforms, cssProperties.<span class="title function_">push</span>(transform)</span><br><span class="line">      <span class="keyword">if</span> (duration &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">typeof</span> properties === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">        cssValues[transitionProperty] = cssProperties.<span class="title function_">join</span>(<span class="string">&#x27;, &#x27;</span>)</span><br><span class="line">        cssValues[transitionDuration] = duration + <span class="string">&#x27;s&#x27;</span></span><br><span class="line">        cssValues[transitionTiming] = (ease || <span class="string">&#x27;linear&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    wrappedCallback = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> event !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (event.<span class="property">target</span> !== event.<span class="property">currentTarget</span>) <span class="keyword">return</span> <span class="comment">// makes sure the event didn&#x27;t bubble from &quot;below&quot;</span></span><br><span class="line">        $(event.<span class="property">target</span>).<span class="title function_">unbind</span>(endEvent, wrappedCallback)</span><br><span class="line">      &#125;</span><br><span class="line">      $(<span class="variable language_">this</span>).<span class="title function_">css</span>(cssReset)</span><br><span class="line">      callback &amp;&amp; callback.<span class="title function_">call</span>(<span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//当可以执行动画的时候，那么动画结束后会执行回调，</span></span><br><span class="line">    <span class="comment">//如果不支持持续动画,在直接设置最终值后，不会执行动画结束回调</span></span><br><span class="line">    <span class="keyword">if</span> (duration &gt; <span class="number">0</span>) <span class="variable language_">this</span>.<span class="title function_">bind</span>(endEvent, wrappedCallback)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// trigger page reflow so new elements can animate</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">size</span>() &amp;&amp; <span class="variable language_">this</span>.<span class="title function_">get</span>(<span class="number">0</span>).<span class="property">clientLeft</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">css</span>(cssValues)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//当持续时间小于等于0时，立刻还原</span></span><br><span class="line">    <span class="keyword">if</span> (duration &lt;= <span class="number">0</span>) <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      that.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        wrappedCallback.<span class="title function_">call</span>(<span class="variable language_">this</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  testEl = <span class="literal">null</span></span><br><span class="line">&#125;)(<span class="title class_">Zepto</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>From: <a href="http://caibaojian.com/zepto-code.html">http://caibaojian.com/zepto-code.html</a></p>
</blockquote>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Wind</span></span>

      <time datetime="2015-09-15T17:37:11.000Z" itemprop="datePublished">9月 15, 2015</time>

      
<span class="categories">
  <a class="category-link" href="/categories/javascript/">JavaScript</a>
</span>


    </p>
    
    <p class="meta">
      
        <a class="basic-alignment left" href="/b/2015/09/eval-he-1-eval-de-qu-bie/" title="Previous Post: eval和(1, eval)的区别">&laquo; eval和(1, eval)的区别</a>
      
      
        <a class="basic-alignment right" href="/b/2015/09/h5-xia-la-shua-xin/" title="Next Post: H5下拉刷新">H5下拉刷新 &raquo;</a>
      
    </p>
  </footer>
</article>


  <section>
    <h1>评论</h1>
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

<!--<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>-->

<script src="/js/gitalk.min.js"></script>


<script type="text/javascript">
      var gitalk = new Gitalk({
        clientID: '50fbdf7a6156260cd0b1',
        clientSecret: 'aeac1ce266e68e5421cdbbcc9b5223378ff0b6bc',
        repo: 'gitalk',
        owner: 'wolfsilver',
        admin: 'wolfsilver',
        id: location.pathname.substring(0, 50),
        labels: 'Gitalk'.split(','),
        perPage: 15,
        pagerDirection: 'last',
        createIssueManually: true,
        distractionFreeMode: false
      })

      gitalk.render('gitalk-container')
 </script>
  </section>

</div>


  <aside class="sidebar">
    
      
<section>
  <h1>分类</h1>
  <ul id="categories">
    
      
        <li class="category"><a href="/categories/essay/" title="Essay">Essay (1)</a></li>
      
    
      
        <li class="category"><a href="/categories/java/" title="Java">Java (3)</a></li>
      
    
      
        <li class="category"><a href="/categories/javascript/" title="JavaScript">JavaScript (5)</a></li>
      
    
      
        <li class="category"><a href="/categories/whistle-js/" title="whistle js">whistle js (1)</a></li>
      
    
      
        <li class="category"><a href="/categories/其他/" title="其他">其他 (1)</a></li>
      
    
      
        <li class="category"><a href="/categories/前端/" title="前端">前端 (5)</a></li>
      
    
      
        <li class="category"><a href="/categories/java/多线程/" title="多线程">多线程 (1)</a></li>
      
    
      
        <li class="category"><a href="/categories/杂谈/" title="杂谈">杂谈 (2)</a></li>
      
    
      
        <li class="category"><a href="/categories/转载/" title="转载">转载 (2)</a></li>
      
    
  </ul>
</section>


    
      
<section>
  <h1>近期文章</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/b/2019/12/whistle-xxtpl/">whistle.xxtpl</a>
      </li>
    
      <li class="post">
        <a href="/b/2018/11/2018-11-01-mian-shi/">2018-11-01面试</a>
      </li>
    
      <li class="post">
        <a href="/b/2018/08/2018-nian-8-yue-25-ri-mian-shi/">2018年8月25日 面试</a>
      </li>
    
      <li class="post">
        <a href="/b/2018/02/duo-yu-ming-dan-zheng-shu/">多域名单证书</a>
      </li>
    
      <li class="post">
        <a href="/b/2018/01/vs-code-zi-ding-yi-gao-liang/">VS Code自定义高亮</a>
      </li>
    
  </ul>
</section>


    
  </aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2024 - Wind -
  <span class="credit">Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></span>
</p>
</footer>
  
<script src="//cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>


<script src="//cdn.jsdelivr.net/npm/modernizr@3.13.0/lib/cli.min.js"></script>


<script src="//cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script>


<script src="/js/script.min.js"></script>






  
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/jquery.fancybox@2.1.5/source/jquery.fancybox.min.css">

  
<script src="//cdn.jsdelivr.net/npm/jquery.fancybox@2.1.5/source/jquery.fancybox.min.js"></script>




<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-60526602-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-60526602-1');
</script>

<!-- End Google Analytics -->



<!-- Baidu Analytics -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?f09124d228ae25c45c871424139d9ca9";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<!-- End Baidu Analytics -->




</body>
</html>
